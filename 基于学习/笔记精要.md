
```
要放原理图模块和pcb模块的次序一样, 更新pcb到原理图.
再画原理图,更新原理图到pcb.
作一个新的工程,放复用模块,更新到PCB,DRC检查,设计->从复用模块更新
从一个复用模块复制到另一个复用模块, 复制原理图,PCB, 两个都更新ID,从PCB转换到原理图.在从原理图转换到PCB.
画模块规范: 
版本一尽可能简洁,不做敷铜,不做弯曲走线,45度即可.
版本二,改为弯曲走线.

两个模块的连线,中间可能会用到总线,总线需要扇出,需要检查网络连线的网络标号,看看是否真的连上了. 网络属性还是都显示.好查找错误.
将引脚名填入网络名
```

嘉立创模块复用功能最终结果.

```
原理图和PCB都同时放置引用模块,后原理图绘画,画完后,更新到PCB.
问题,不可以更改使用的模块.否则会出问题.

为了大规模使用的规范:
	使用英文命名,出问题会减少,运行速率会增加
    多做备份,做流程管理.
	模块的原型资料,基于什么,需要有原理图,PCB.
	bom(嘉立创连接或者商品, 淘宝连接,价格说明,数据手册连接).
	这个模块统一的规则(PCB规则, 原理图规则等).
	特殊规则说明(走线宽度, 走线间距, 差分阻抗控制, 敷铜间距).
	使用说明.
	更新了什么.
	心得体验和遇到问题解决.
比如
1.重要规范和学习路线
2.模块来源
3.原理图的说明
4.PCB的布局规则说明
5.遇到问题及其解决心得
6.模块版本更新说明
7.bom表
8.bom表的说明
9.PCB布局规则文件
```

## 单片机最小系统

```
推荐芯片: STC15W4K56s4
	推荐淘宝商家:优信电子, 深圳育松电子
	时钟电路的晶振 STC89C51通常用6M 12M 20M 3.6864 11.0582 22.1184 ,后面几个是为了串口通讯.
	PCB开发板做法: 洞洞板 热转印 厂家PCB 面包板.
	
	最小系统选型, 一般0805封装. 电阻包 电容包 元件册 杜邦线; 
	stc89C52dip40 直插的; 
	时钟电路 12M晶振直插 30pF电容直插;
    复位电路 10K欧姆贴片电阻, 10uF 25V电解, 小开关; 
    防反接 保护 滤波 自锁 电路, 
    直插接口(P = 2.56mm),自锁开关, PMOS管 2301; 100uF 25V 电解电容, (10K欧姆贴片电阻, LED 3MM LED灯),  100nF MLCC;
```

### 绘制

使用他人的原理图,PCB图:

```
切换keep-Out layer层
shift+s 切换单层显示
DSD 设计(D)->板子形状(S)->按照选择对象定义(D)
shift+s 切换单层显示
ctrl+s保存 PCB binary version 6.0保存
设计D规则R 右键->导入规则 ctrl+a全选,选择规则导入
ctrl+s保存
```

一些操作:

```
立创EDA下载AD的原理图乱码, 就新建一个原理图,复制粘贴即可.
替换:焊盘,引脚对应,点上焊盘, 框选,右键,联合,从选中的器件生成联合.移动到空位,右键联合,打散,关闭所有和新的器件位置适应,新的器件,选中,Ctrl+C Ctrl+V,放在位置上,网络就有了.
过孔大小 12/24	16/34	24/50
线宽 10mil 18mil 24mil P+F
敷铜间距 8mil 16mil
工具T取消布线U全部A
工具T取消布线U器件O
双击焊盘,电气类型,改变电器属性
忽略报错,工具T复位报错标志M
ctrl+D 视图设置,隐藏 隐藏顶层的地
Vin的地输入细了(25mil)可以用20mil的一层锡, top solder层, 同时电感输出焊盘加大.
显示网络 NSA
PL 走线无电气属性 PT走线有电气属性
```

### 自己创建:

VI VO IO 芯片厂家的计算

```
    原理图数值改造:
电容,MLCC >钽电容 > 固态电容 > 高频低阻电解 >电解
Ci的耐压为VIN * 2, 电容量翻倍.
CO的耐压为VOUT * 2, 电容量翻倍.
IC左边并一个0.1ufC1, 负载左边并一个0.1ufCo.
分压电阻的阻值不要乱取,R1要与芯片手册相近.
自举电容可以参照计算结果.
电感量可以参照,电感通过电流为 Io * 1.5,封装尺寸大一些 127,封装选一体成型屏蔽电感.
```

一些选型:

```
接口header封装 KF128
电阻,电容容封装 0805或1206
电感封装 贴片功率电感127
肖特基SMB封装SS34
芯片 PSOP8封装

问题 sw从0.1uFci下面穿过, 0.1uFci改为1206封装   
电感Vout的地方可以大一点,使用127来画PCB,这样可以有什么电感焊什么电感.加上大焊盘
```

原理图转换为PCB图

```
封装添加完后 工具标注所有器件
仔细检查一下,避免返工
update 生效更改 执行更改
保存 保存拷贝为(备份PCBdoc文件)
```

操作:

```
    字太大:右键 查找相似对象(N)(sheft+F) 点击丝印 Text Height (same) 应用 确定 Text Height改为40mil Stroke Font改为Sans senf字体.保存
    Ctrl+点击 这个网络的都亮
    交叉选择:原理图 选择器件 工具T选择PCB器件S PCB图中对应器件被选中
    设置原点:视图E原点O重新设置S
    定义板子面积:keep-out-layer层,画两条线,EOS设置原点,按Q切换为mm,后双击线条,设置线长度, sheft+s单层显示,DSD设置板子形状.
    板子固定孔:内 3mm X 4mm Y 4mm 对齐 网络GND 位置 (3mm,3mm)
    过孔大小: 12/24 16/34 24/50 mil
    线宽 12mil 18mil 24mil P+F
	敷铜间距 8mil 16mil
	走线: P+F填充 P+R实心区域 P+G敷铜 P+w线(+*过孔到对面)
	敷铜:敷铜间距12mil,敷铜连接方式,直接连, 敷铜,GND,死铜移除.
```

提前操作

```
引入规则,敷铜间距12mil,
修改字体
保存备份
```

器件布局

```
正对芯片
Ci抵近VIN GND
FB面积最小 地通过过孔到背面, 反馈从最后一个0.1uFCo中引入,过孔走背面.
SW面积最小(肖特基 电感 Cboot 通过过孔到SW或BST) PR实心区域
电感的Vout面积大一些,周围挖空,输出强制通过Co
ss comp 小型号布局, SS走线24mil ,comp走线12mil , FB ss comp的地连一起,周围挖空.
PGND可以PF填充连在一起
```

后续处理

```
Ci Co 芯片旁边打过孔, FB引线可以包地处理.
电感的输出部分可以加入大焊盘, VIN VOUT GND这些出入口加入焊盘,加入丝印.
摆放好丝印.
四周打上固定孔,敷铜.
看3D图,观察焊盘是否有过孔.
```

三、绘制PCB常用快捷键

```
3.1 P+T---->绘制电气连接线
3.2 P+T+"*"---->先用P+T绘制导线, 再按小键盘上的“*”键实现换层, 并放置过孔
3.5 T+E---->添加/去除泪滴焊盘
3.11 G----->设置捕捉距离
3.12 L----->显示层设置对话框
3.15 3+shift+鼠标右键---->实现PCB 3D模型旋转/反向
3.18 V+B---->查看背面元件布局（返回正面同样按V+B）
3.19 E+D---->删除选中的对象
3.20 Ctrl+M---->测量对象尺寸/距离
3.22 T+C---->PCB与原理图元件相互选中定位（既在PCB中选择的元件会在原理图中高亮显示, 反之亦然）
3.23 M+S---->移动选中对象
3.23 N+S---->显示网络飞线
3.24 N+H---->隐藏网络飞线
T+S键 框选器件放置
CTRL+SHIFT+ T 、B、L、R 可以快速对齐所选中的元件 上 下 左 右.
t c交叉探针 原理图选器件,PCB器件高亮
shift + E切换电气网格
刷新屏幕: END
shift+空格键 走线模式改变
测量距离:ctrl+M
```

六、单位换算

```
1mil=1/1000inch=0.0254mm
10mil=0.01inch=0.254mm

1mm=39.37mil
10mm=393.7mil
```

## AD10

[AD10安装](https://www.bilibili.com/video/BV1py4y1D78A/?spm_id_from=333.337.search-card.all.click)

### 一、绘制原理图常用快捷键

```
1.1 Home--->以光标为中心显示当前页面（PCB通用）
1.2 PageUp---->以光标为中心放大当前页面（PCB通用）
1.3 PageDown---->以光标为中心缩小当前页面（PCB通用）
1.1 P+W---->放置电气导线
1.2 P+P---->放置元件符号
1.3 P+N---->放置网络标识
1.4 P+T---->放置文字
1.5 P+D+L---->画线
1.6 P+D+R---->画填充的四边形
1.7 空格键---->选中元件/字符/标识旋转放置
```

### 二、绘制元件符号快捷方法

```
2.1 P+P---->放置元件管脚
2.2 P+P+"TAB"---->重置管脚编号
2.3 空格键---->选中管脚进行旋转放置
```

### 三、绘制PCB常用快捷键

```
3.1 P+T---->绘制电气连接线
3.2 P+T+"*"---->先用P+T绘制导线, 再按小键盘上的“*”键实现换层, 并放置过孔
3.3 P+V---->放置过孔
3.4 P+P---->放置焊盘
3.5 T+E---->添加/去除泪滴焊盘
3.6 P+G---->铺铜
3.7 P+L---->画线（非导线）
3.8 P+S---->放置字符
3.9 P+C---->放置元件封装
3.10 Q----->英制/公制单位切换
3.11 G----->设置捕捉距离
3.12 L----->显示层设置对话框
3.13 3----->显示PCB 3D模型图
3.14 2----->从3D模型图返回2D平面图
3.15 3+shift+鼠标右键---->实现PCB 3D模型旋转/反向
3.16 空格键---->选中元件/字符/标识旋转放置
3.17 E+O---->设置PCB原点
3.18 V+B---->查看背面元件布局（返回正面同样按V+B）
3.19 E+D---->删除选中的对象
3.20 Ctrl+M---->测量对象尺寸/距离
3.21 T+U---->删除所有布线3.22 T+C---->PCB与原理图元件相互选中定位（既在PCB中选择的元件会在原理图中高亮显示, 反之亦然）
3.23 M+S---->移动选中对象
3.23 N+S---->显示网络飞线
3.24 N+H---->隐藏网络飞线
3.25 D+R---->显示设计规则对话框
```

### 四、快速放置元件

```
4.1 如果元件数量不多（<20个）时, 可以逐个元件按功能布局放置
4.2 元件数量较多时, 可以先在原理图中选中相应的功能模块, 然后按T+S键, 会自动在PCB界面中显示选中的元件, 然后用鼠标在希望放置的地方画个矩形框, 选中的元件会自动放置在矩形区域内, 然后手动调整即可
```

### 五、常见问题处理

```
5.1 重装AD前, 切记备份好自己制作的库文件, 重装完成后再导入
5.2 加载PCB库文件后, 记得√选“Libraries”中的“Footprints”,才会显示在库文件列表中, 如下图点击蓝色圆圈中的三个圆点, 然后勾选红色箭头所指选项即可
5.3 如果PCB尺寸超过了现有的界面, 可以选择主菜单“Design”->"Board Shape"-"Redefine"重新定义板子尺寸
5.4 如果想恢复以前的文件, 可以从当前文件目录中的“History”中恢复
5.5 加载库文件时, 可以单独加载原理图库（.schlib）和封装库（.pcblib）;也可以加载集成库文件（.intlib）,如下图但是.libpkg文件只能修改集成库时使用, 不能当做原理图或封装库使用.
```

## PCB

### 线性电源PCB layout宝典

```
1.输入电容和输出电容要放置在紧靠VIN,VOUT和GND的地方;
2.输入要经过输入电容Co以后再进入IC;
3.反馈信号要从输出电容近负载一侧获取;
4.输出要经过输出电容以后再引出到负载;
5.输入和输出侧的地要在IC处合在一起成为公共点;
6.尽量加大焊盘面积,这样做对降低热阻,加强散热有好处;
7,如果使用外部反馈电路,反馈组件应当放置在靠近IC的地方.
```

### BUCK开关电源PCB layout宝典

```
1.采用晶圆倒装工艺的BUCK芯片 (DIY不可行)
2.将Ci集成到芯片内部(一般芯片不可行)
3.电感RC->Ci->0.1ufCi->芯片->电感->Co->o.1ufCo->磁珠RC
4.0.1ufCi->芯片, 0.1ufCi尽量靠近芯片的VIN和GND引脚,强行滤波后再进入芯片引脚.
5.与FB相连的两个电阻越靠近FB引脚越好,FB覆盖面积越小越好.走线细而短,可以滴上704硅胶,防止手摸.
6.减少辐射EMI,减少高di/dt回路面积,SW覆盖面积越小越好.高di/dt回路是最看重的回路.
7.小信号地连一起(FB分压电阻,COMP相位补偿,ss软起动),然后再与PGND单点相连,或者通过过孔连到背面.这些周围不敷铜.
8.电感采用一体成型屏蔽电感,将电磁场封锁.
9.背面走线越少越好,背面走线最好与正面走线垂直,然后最好全部敷铜到GND.
10.电感两个引脚间距离尽可能大一些,可以选大一尺寸的电感,如果位置允许. 非一体成型电感最好把GND挖空,一挖到底,还要让敏感电路和回路远离电感.特别是VO到FB的走线.特别要避开电感,二级管,特别是不能和电感并行.
11.PCB设计参考厂家数据手册.
12.最好是用4层板,一层器件,2层GND,3层4层走线.
```

### BOOST开关电源PCB layout宝典

```
1.高di/dt回路面积越小越好,这里指的是sw->肖特基->Co.
5.与FB相连的两个电阻越靠近FB引脚越好,FB覆盖面积越小越好.走线细而短,可以滴上704硅胶,防止手摸.
6.减少辐射EMI,减少高di/dt回路面积,SW覆盖面积越小越好.高di/dt回路是最看重的回路.
7.小信号地连一起(FB分压电阻,COMP相位补偿,ss软起动),然后再与PGND单点相连,或者通过过孔连到背面.这些周围不敷铜.
8.电感采用一体成型屏蔽电感,将电磁场封锁.
9.背面走线越少越好,背面走线最好与正面走线垂直,然后最好全部敷铜到GND.
10.电感两个引脚间距离尽可能大一些,可以选大一尺寸的电感,如果位置允许. 非一体成型电感最好把GND挖空,一挖到底,还要让敏感电路和回路远离电感.特别是VO到FB的走线.特别要避开电感,二级管,特别是不能和电感并行.
11.PCB设计参考厂家数据手册.
12.最好是用4层板,一层器件,2层GND,3层4层走线.
```

## 运放大师

```
运放重要参数:
	供电电压Vs,Vs * 0.8
	增益带宽积GBW,GBW > (10~100) * gain * f
	压摆率Slew Rate,SR > 2 * pai * f * Vopp
 
单片机的ADC的 Rin Cin 计算. 需要关注ADC的参数: 采样开关电阻Rsw 采样保持电容Csh
Cin > 20 * Csh
Cin * Rin = 0.7 * Rsw * Csh
Cin 一般 479pF 680pF 1nF
ADC的保护,钳位:两个ss34, 双向TVS BAT545 BAV99 BAV199

供电: 首先考虑尽可能使用双电源,单电源(频率f < 100Khz,直流)可以使用.
供电滤波电容,100M示波器上一般都用22nf, 频率再高就降低一点电容量.

单电源供电, 反馈Rf串一个Cf,低通滤波器,进行滤波. Rf//Cf在-IN接一个低通滤波R2 C2到地,滤去高频交流信号,直流完整通过,所以直流的放大比为1,高频交流的放大比为R2/Rf.
有C2 放大为 Vcc/2 + Vi * Au
无C2 放大为 ( Vcc/2 + Vi) * Au

单电源:制造虚地, 分压->电压跟随器(变阻抗) TL431芯片 稳压二极管.
TL431并联的电容 <0.01uF 或者 >3.3uF

单电源供电用的多的地方:反相比例,同相比例,差分电路.

耦合: 频率相同,相加减. 直流耦合,交流耦合.
通过电容耦合到+IN时,+IN处需要加一个电阻进行阻匹配.
通过电容耦合到-IN时,不需要.
22nF < 50Mhz
100pF >500Mhz

大多数情况下,使用电压反馈运放 VFB.CFB在频率f>10Mhz时使用.
有源滤波器使用于截止频率<5Mhz的场合.当截止频率>5Mhz,最好采用LC无源滤波器.
```

EMI设计

```
滤波 10uF(库电容) 0.1uF 6.8uF(去耦电容)

滤波 50欧姆 串( 10uF 0.1uF 470pF) 形成低通滤波器.
运放处理信号 < 10Mhz,最小的 0.1uF
运放处理信号 > 10Mhz,最小的 0.01uF
处理小信号时,双电源供电,避免削底.
LM7705可以提供 -0.2V的负电压
V+ V-之间, 0.1uF的电容,去除高频偶次谐波.
V+ GND或 V- GND之间, 0.1uF电容,去除谐波.
小电容靠近VDD VEE, 大的库电容原理VDD VEE.

反相输入端-IN的面积最小,这里高阻抗,容易耦合干扰信号

同相比例最讨厌的地方是容易带入共模干扰
一般使用反相比例
Rf可以并上一个电容,低通滤波器.fo = 1/(2*pai * Rf * Cf). fo频率不宜太小, 比如运放1Khz的方波, 可以保留17Khz以下的波.

运放PCB注意:
1.运放的反相 IN- 的杂散电容最容易引起振荡, IN-不应该接电容到地, 同时敷铜距离 30mil. 
2.运放的输出 OUT 不能带容性负载,最好串一个20欧姆电阻.
3.运放供电 10UF库电容 0.1uF去耦电容 470pF去耦电容, 再串一个电阻,低通滤波.
4.Rf并一个Cf,低通滤波器.fo = 1/(2*pai * Rf * Cf). fo频率不宜太小, 比如运放1Khz的方波, 可以保留17Khz以下的波.
```



## 电源大师

DCDC电源

```
线性电源
	线性电源,压差>1.2V
	LD0, 压差<=1.2V
开关电源
	电容式开关电源(电荷泵)
		反相
		倍压
		半压
	电感式开关电源
		buck
		boost
		buck-boost
```

公司技术排名

```
TI > 南芯>ADI>MPS
南芯用的晶圆倒装, QFN封装,对DIY不友好
```

### 线性电源

线性电源参数

```
输入电压Vi
输出电压Vo
压差Vd
噪声
静态电流Iq
```

LDO开关

```
工艺:
两个NPN达林顿管 2V
一个NPN,一个PNP, 1V 准LDO
一个PNP, 0.3V, LDO
NMOS , <0.5v, LD0
PMOS

PMOS的LDO 成本是最优,是主流, Vd也小
Mos的LDO的问题:电流可能倒灌 反接容易出问题  可靠性比较低
```

选择

```
输入电压Vin>管压降Vd + 输出电压Vout
效率: n = Vout/Vin
注意: Vin - Vout > Vd(压差)
手持设备应该选低Iq(静态电流)的LDO
7085 Vd = 2.5V 
LM317 Vd = 3V
```

注意

```
LDO不能并联扩流,会烧毁.除了RT9068
LDO可以通过三极管扩流,需要注意成本.
电流反馈型可以并联扩流,LT3080
兼顾纹波和效率: buck 后接磁珠和电感做的LC低通滤波,再接LDO.
手机无线充电: 发送端电磁波, 接收端的电磁波谐振接收能量 接收端用LDO来降压
不需要Co XC6504
测井仪器:芯片有过热保护,不能用于测井,所以用运放和独立元件搭建LDO来供电.
```

PCB注意

```
输入需要经过Ci再入IC
输出需要经过Co再入RL
Ci,Co紧靠VIN,VOUT,GND.
输出要经过Co再入反馈
芯片底部和周围大面积铺铜,增加散热.
R1,R2贴近IC
```

### 电容式开关电源(电荷泵)

重要参数

```
vi输入电压
Vo输出电压
Io输出电流
Iq关断电流
Vn噪声
```

芯片

```
非稳压型电荷泵
	负压 ICL7660 ICL7662
	倍压
	半压 SC8551 NU2205 LTC7820
稳压型电荷泵
	升压 HX4002 HX4004
	降压 DRV8301
	负压 LM7705
```

工作原理

```
负压:周期0~2Π, 0~Π, 电容正接(VCC,GND)充电, Π~2Π,电容反接(原VCC接GND, 原GND接Vout)放电
倍压: 周期0~2Π, 0~Π,电容并联充电, Π~2Π,串联放电.
半压:周期0~2Π, 0~Π,电容串联充电, Π~2Π,并联放电.
```

```
电容式降压: 降压: 线性电源->半压	半压->LDO

ICL7660 ICL7662 负压
Fsw越大, 周期T越小,Cfly越小,容易充满
四个开关内置,Io很小
可以并联,增加输出.

MAX232 倍压后负压 获得 2Vi -2Vi
可以用作串口通信的供电
LM7705结构: 负压->LDO
UC7820结构: 开关外置, 加检测Io的过流保护
```

电容选择

```
推荐: 电容Ci Cfly Co 为的电容量为芯片手册推荐的2倍, 耐压为寻常承受电压的两倍,电容的ESR越小越好
顺序: MLCC(X7R>x5R) > 钽电容 > 固态电容 > 高频低阻电解 > 电解

电容比较大好一些:
温度T上升,电容下降,温度T下降,电容下降,随时间推移,电容下降.需要留余裕.(上电复位电路,电容量随时间减小,失去复位作用.)
电容量大一些,可以承受更多电流通过.
电容过大,电感容易过热损毁,电容过小容易烧毁电容(上电瞬间的过冲电压损坏电容).

电容的ESR越小:
减少输出纹波(输出电容Co的ESR减小, Co变大)
电容的ESR越小效率越高
```

PCB设计

```
没什么讲究, Ci Cfly Co 接近芯片, 
如果是稳压型,发热大一些,焊盘做大.

降低纹波: 
Ci Co都并联一个0.1uF, Ci的0.1uF靠近芯片, Co的0.1uF远离芯片
20欧姆Rp 和Cp RC低通滤波
600m欧姆磁珠Lp和Cp  LC低通滤波
```

其他

```
开关管内置的Io<=200mA, 外置的Io可达20A
非稳压型效率可达99%

特殊:
LDO 压差小的效率很高
开关电源的噪声可以很小
电荷泵的芯片的开关外置的电流可以很大.

电荷泵与电感式DCDC比优点:
	高效率
	体积小
	低静态电流
	最低工作电压更低
	低噪声

手机快充, 20V高压送电,输电线的发热小,手机内部空间宝贵,不能放电感, 所以用的半压
```

### buck

降压BUCK应用

```
降压 STEP DOWN
负电压 
FLYBUCK升降压,负电压,多组输出(隔离式flybuck 非隔离式flybuck)
ZETA升降压
正电压升降压
```

BUCK原理

```
降压:开关打开,电感充电.  开关闭合,肖特基续流,电感给后面供电.  后接电容滤波,减少纹波.(大电容储能,小电容滤波)
	输入电容里面小的滤波, 大的是储能的, 负载突然加大, 
	输入电压会跌落, 输入电容会回吐储能
	
	开关可以用NPN PMOS NMOS,现在主流式NMOS
	二极管,低压用肖特基,高压用快恢复二极管
	芯片内置的开关通过电流小, 大于5A,使用外置NMOS

电感式开关电源里面有80%都是buck电路
占空比D = ton/(ton+toff) = ton/Ts
周期 Ts = 1/Fsw
效率n = Vo/Vi = D < 1
肖特基损耗: Uf * Io ( 例如 0.3欧姆 * 1A) 肖特基二极管的Uf小,损耗小
同步整流肖特基换为NMOS, 
NMOS损耗: Rds(on) * Io (比如 0.1欧姆 * 1A), 比肖特基小.
同步整流buck电路上下管不能同时导通(会导致短路),需要设置死区,一般为12ns到28ns之间
下管并联一个肖特基,可以提高效率
	
负电压:降压电路的GND连起来做输出,Vout连GND即可
FLYBUCK:使用同步电感,需要同步整流buck芯片
	升降压: 改变同步的绕组, 使用电荷泵
	负电压:降压电路的GND连起来做输出,Vout连GND即可
	多组输出:多个绕组, 使用电荷泵
	隔离,非隔离是看多个输出的GND是否连在一起.
ZETA升降压: 降压电路加一个电感一个电容. 主线路上开关和电感间加一个电容, 这个电容和开关间加一个电感到地.
	所有buck电路都可以改造为zeta电路,用来做升降压
	增加一个电感和一个电容, 
	电感可以用一个耦合电容(贵)或两个非耦合电感(便宜)
	能量传递, C1 95%, L1 5% ,如果不用耦合电感会损失5%
正电压升降压(后面添加两个开关,相当于buck后接boost)(性价比不高)
```

```
flybuck 给运放供电很好, 纹波小
```

```
纹波小,EMI小,消减振铃信号:
buck: 电感LC滤波->CI->0.1ufCi->开关->续流->电感->Co->0.1ufCo->磁珠LC滤波
晶圆倒装, 0.1ufCi尽可能靠近VIN,GND, RC缓冲抑制电路, 反馈可以取Co->0.1ufCo之间,R1,R2尽可能靠近FB引脚.

封装:金线键合对DIY友好,晶圆倒装EMI非常小
开关切换时会有高频振铃信号产生:
 	开关寄生电感 * (引脚电感+ Ci距离VIN和GND的电感+ Ci本身寄生电感)
 	晶圆倒装可以大大减小引脚电感
 	Ci选用0.1uF可以减少Ci本身寄生电感
 	Ci距离VIN,GND尽可能近可以可以减小其中电感
 	电感可以集成到芯片内部,减少寄生电感
buck: CI->0.1ufCi->开关->续流->电感->Co->0.1ufCo
	开关闭合时,0.1ufCi->开关->续流->电感->Co 围成的回路有电流, 开关打开时,续流->电感->Co围成的回路有电流, 而0.1ufCi->开关->续流围成的回路无电流.
	0.1ufCi->开关->续流围成的回路电流变化大,即di/dt变化大,容易成为一个电感,产生EMI, 需要尽量减少这个回路的面积.
	即0.1ufCi距离VIN,GND尽可能近.
RC缓冲抑制电路:
	添加RC缓冲电路可以有效抑制振铃现象,同时造成开关切换损耗增加.
	RC缓冲电路应当放置在紧靠开关节点和功率地处.
	
	Buck芯片软启动的GND,反馈的GND,相位补偿的GND,都是小信号的地,
	功率地与小信号的地单点相连,或者通过过孔相连,减少环路电流.
	进行EMI设计, 前面加电感 IMC滤波,后面加磁珠,IMC滤波,纹波可能比LDO还小.
```

芯片参数

```
参数: VI VO IO Fsw EN VFB
Up常用芯片 TPS5450

计算:
可以用官网的来计算,
可以用官网的数据手册来计算
可以用电阻分压计算器来计算(Err比较小好一些),可以参考数据手册来看
```

参数设计

```
尽量利用厂商的参数设计: 
TI的webench
MPS的 DC DC在线设计师
中国大陆比较有名的是龙芯,南芯,圣邦微
```

效率与频率的关系

```
频率升高: 开始效率升高,达到最大,效率减小, 
前面是导通损耗占主要, 后是开关损耗
频率上升,需要的电感变小, 可以用更粗的线做电感, DCR就小.电感上的损耗就更小
```

CIN,COUT选择

```
CIN:高频低阻电解或固态电容 + MLCC X7R 22uF+0.1uF
COUT:MLCC X7R 0.1uF + MLCC X7R 22uF + 固态电容.
MLCC > 钽电容 > 固态电容 > 高频低阻电解 > 铺铜电解
```

BUCK开关电源PCB layout宝典

```
1.采用晶圆倒装工艺的BUCK芯片 (DIY不可行)
2.将Ci集成到芯片内部(一般芯片不可行)
3.电感RC->Ci->0.1ufCi->芯片->电感->Co->o.1ufCo->磁珠RC
4.0.1ufCi->芯片, 0.1ufCi尽量靠近芯片的VIN和GND引脚,强行滤波后再进入芯片引脚.
5.与FB相连的两个电阻越靠近FB引脚越好,FB覆盖面积越小越好.走线细而短,可以滴上704硅胶,防止手摸.
6.减少辐射EMI,减少高di/dt回路面积,SW覆盖面积越小越好.高di/dt回路是最看重的回路.
7.小信号地连一起(FB分压电阻,COMP相位补偿,ss软起动),然后再与PGND单点相连,或者通过过孔连到背面.这些周围不敷铜.
8.电感采用一体成型屏蔽电感,将电磁场封锁.
9.背面走线越少越好,背面走线最好与正面走线垂直,然后最好全部敷铜到GND.
10.电感两个引脚间距离尽可能大一些,可以选大一尺寸的电感,如果位置允许. 非一体成型电感最好把GND挖空,一挖到底,还要让敏感电路和回路远离电感.特别是VO到FB的走线.特别要避开电感,二级管,特别是不能和电感并行.
11.PCB设计参考厂家数据手册.
12.最好是用4层板,一层器件,2层GND,3层4层走线.
```

案例:

```
由两只22uF/25V大型电容器换成小体积的22uF/6.3V电容
22uf/6.3V 0805 规格的MLCC 电容在3.3V 直流偏置下只有11uF的容量
BUCK输出的低交流纹波又使得这个值还要再降低28%
所以最后得到的输出电容只有16uF的有效值.低于设计值44uF.
启示:Co的耐压应当远大于Vo,才能保证电容量不过分减小.Ci 0.1uFCi CO的尺寸可以大一点.
```

### boost

常用BOOST芯片 

```
B628(SX1308、MT3608) 
XL6019 
TPS55340 
TPS40210 
TPS61088 
LM5122  
B628和XL6019可以解决你98%的升压问题.同步整流BOOST, 非同步整流BOOST 开关管内置/开关管外置 BOOST电路不能关断, 
主要是PBC布线要把握几点:SW面积越小越好, 电感越靠近芯片越好, 两个反馈电阻靠近FB脚, VO到反馈电阻间连线避开SW, 电感, 最好包地.
```

boost应用

```
升压boost
sepic正压升降压
cuk负压升降压
sepic+cuk正负双电压升降压
flyback(隔离式flyback, 非隔离式flyback)
forward正激
```

结构

```
Boost: ton,开关打开,电感充电, toff, 开关闭合,肖特基导通,电感+VIN供电升压. 电容滤波稳压.
	CI->电感->开关->肖特基->Co->反馈
SEPIC:(耦合电感的电感量是非耦合的1/2)
	CI->电感->开关->电容->电感->肖特基->Co->反馈 升降压
FLYBACK反激:反激不能空载.
	CI->高频电感->(开关->肖特基->Co->反馈->输出1), (肖特基->Co->输出2)
```

boost注意

```
boost不能关断电流,除非有保护电路.
boost不能防止短路.需要有保护电路.
保护电路通常由 PNP 或 PMOS等组成.
AAM 接一个电阻到地,轻载的时候,效率高,纹波大,工作在AAM模式.
AAM 接一个电阻到Vout,轻载的时候,效率低,纹波小,工作在COM模式.
反馈回路的R2并一个前馈电容,为了防止负载RL变化导致的Vout过冲对FB造成不良影响.
```

EMC设计

```
最重要的高di/dt回路, 含电感的回路可以排除(电感电流不会突变)
	CI->电感->开关->肖特基->Co->0.1uFCo-->反馈 
	ton: CI->电感->开关 Co->0.1uFCo-->反馈 有电流
	toff:CI->电感->开关->肖特基->Co->0.1uFCo->反馈 有电流
	高di/dt回路: 开关->肖特基->Co, 即SW
SW面积越小越好, 电感越靠近芯片越好, 
两个反馈电阻靠近FB脚, VO到反馈电阻间连线避开SW, 电感, 最好包地.
```

BOOST开关电源PCB layout宝典

```
1.高di/dt回路面积越小越好,这里指的是sw->肖特基->Co.

5.与FB相连的两个电阻越靠近FB引脚越好,FB覆盖面积越小越好.走线细而短,可以滴上704硅胶,防止手摸.
6.减少辐射EMI,减少高di/dt回路面积,SW覆盖面积越小越好.高di/dt回路是最看重的回路.
7.小信号地连一起(FB分压电阻,COMP相位补偿,ss软起动),然后再与PGND单点相连,或者通过过孔连到背面.这些周围不敷铜.
8.电感采用一体成型屏蔽电感,将电磁场封锁.
9.背面走线越少越好,背面走线最好与正面走线垂直,然后最好全部敷铜到GND.
10.电感两个引脚间距离尽可能大一些,可以选大一尺寸的电感,如果位置允许. 非一体成型电感最好把GND挖空,一挖到底,还要让敏感电路和回路远离电感.特别是VO到FB的走线.特别要避开电感,二级管,特别是不能和电感并行.
11.PCB设计参考厂家数据手册.
12.最好是用4层板,一层器件,2层GND,3层4层走线.

13BOOST的Co的地不纯净, 不能作为FB的地.
```

地是否纯净?

```
Buck电路的Ci的GND不纯净,Co的GND纯净,
Boost电路的Ci的GND纯净,Co的GND不纯净,
判断条件为是否位于高di/dt回路中.
Boost电路的GND最好与FB的地单点相连.否则会造成纹波.

电感的两个脚过近,会引入一个寄生电容,引起振荡.
```

### BUCK-BOOST

途径

```
升降压 BUCK-BOOST
BUCK芯片负电压升降压 
BUCK芯片正电压升降压 (不合算)
BUCK芯片ZETA正电压升降压
BOOST芯片 SEPIC正压升降压(可以给运放供电,可以用耦合电感,可以不用,SEPIC最好是用非同步整流BOOST)
BOOST芯片 CUK负压升降压
SEPIC-CUK正负双电压升降压
FLABCK反激正电压(必须用耦合电感)
两开关管/四开关管BUCK-BOOST
```

最常用 

```
	BUCK芯片ZETA正电压升降压
	BOOST芯片 SEPIC正压升降压(可以给运放供电,可以用耦合电感,可以不用)
```

```
单片机 NMOS驱动 四开关 STM32F334 FD2105 做升降压
TI 残次品 降电压 降电流, 改名称. LM5118->LM25118
TPS63070 智能小车经常用,但是不好焊接.
MPS型号注水严重
SC8801是双向DCDC,降压最小电感,升压最小电感,取大,然后*1.2
zeta可以用耦合电感, 可以不用.zeta升降压不用耦合电感会降低5%的效率.
Flyback实现升降压,必须用耦合电感
SEPIC最好是用非同步整流BOOST
SEPIC高di/dt为两个开关和Co的回路, 
疏松电感去共模纹波更有效
磁珠LC低通去差模纹波更有效
```

常用BUCK-BOOST芯片

```
常用BUCK-BOOST芯片
SC8701
SC8703
SC8903
RT6150
LM5175
TPS6020
TPS6060
TPS6070
LM5118
LM25118
LTC3789
```

### 参数计算

```
TPS55340
TPS52560
```

```
降压,没有工具,参考TI的TPS54560,将频率改换.
电容,MLCC >钽电容 > 固态电容 > 高频低阻电解 >电解
Ci的耐压为VIN * 2, 电容量翻倍.
CO的耐压为VOUT * 2, 电容量翻倍.
IC左边并一个0.1ufC1, 负载左边并一个0.1ufCo.
分压电阻的阻值不要乱取,R1要与芯片手册相近.
自举电容可以参照计算结果.
电感量可以参照,电感通过电流为 Io * 1.5,封装选一体成型屏蔽电感.
```

```
升压电路参考 TPS55340, 电感感量可以取大点,(2倍,5倍都可以),电感的封装可以取大点.1206都行.
```

```
前馈电阻计算:
TI: Cff = 1 / ( 2 * 派 * ( Fsw / 20 ) * R1) 有点粗暴
另一个: Cff = 1 / ( 2 * 派 * R1 * BW * 0.8), BW为 R1上的电压振荡周期. 
如果datasheet上说可以加前馈电阻,就可以加,否则不要加.
加入前馈电阻,可以减少负载突变时的过冲.
Ss 软启动, 可以使突然加上负载时,电压缓慢上升,不会过冲.ss为小信号,电容值可以取的稍大一点.
输出电压最小值等于内部参考源电压.
保留上部电阻.
分压电阻不可以乱取.
```

### 电路镜数控电压源设计,PWM做ADC

```
最终方案: STM32芯片输出PWM->两级RC低通滤波变直流->电压跟随器变阻抗->电流镜替代R1->控制电源芯片Vo输出.

直接通过DAC来控制芯片的电压输出.问题是DAC输出电流越小,VO越大.

解决方法是,通过电流镜来代替R1,使得DAC电流上升时,输出电压Vo上升.电流镜BCV61很便宜.0.7元.计算时需要注意电流镜管压降0.7V

但是DAC很贵.用PWM做DAC
PWM需要变为直流,同时滤波, 所以要两级低通滤波,同时PWM的频率较高,比如2Khz,纹波会比较小,同时PWM的占空比D比较大,纹波也会减少.
PWM的阻抗不可控,可以使用电压跟随器改变阻抗.或者使用正比例运放,改变阻抗时也可以调节输出电压.运放的Rf可以并联一个去耦电容.减少纹波.
降压芯片可以使用LM5117 LM5116

其他方案:直接2596＋一个358做比例积分器不就行了.给多少DAC输出N*DAC,https://oshwhub.com/Suaig/mppt里面的DC-DC是2596模块拆掉滑动变阻器露出FB端.
```



## 开关电源

### 线性电源

```
参数;输入电压VI 输出电压VO 输出电流IO 管压降Vd 噪声Vn 静态电流IQ 
(7805 7905 LM317 LM337)现在不常用
(117-3.3 TPS7A4901)常用

常用稳压芯片
78系列 79系列 固定输出
LM317 LM337 可调输出
REG1117
LM2596
```

### 开关电源

buck 参数:

```
输入电压VI范围
输出电压Vo范围
最大输出电流大小Io
开关频率fsw
EN脚和FB脚参考电压 
```

常用buck开关电源芯片:

```
mps公司:  mp4560 mp1593 
TI:TPS5450 TPS5420 TPS5420
LM2576 LM2596 MC34063
```

BOOST芯片:

```
SX1308= MT3608 = AX5523 (B628开头)
TPS61040
TPS55340
TPS40210
TPS612088
MP1540
```

BUCK-BOOST芯片:

```
LM5175
LM5118
LM25118
TPS63020
TPS63060
TPS63070 
```

### 开关电源

常用稳压芯片

```
LDO 是low dropout regulator 低压差线性稳压器.
高电压,大电流,低压差 TPS7333
```

开关电源

```
开关频率越高 效率越高 需要的L越小.
需要电感 肖特基二极管(ss14 ss34 ss54) 电容
可以用三级管扩流来突破1.5A限制,比如TIP41 TIP42 但要注意价格
```

兼顾效率与纹波

```
	减少纹波:选用LDO,滤波 MCU的ADC和DAC对纹波敏感,12V(LM2596)->7.5V(7805)->5V(给ADC,DAC供电) 再用电感电容给MC供电. 0欧姆电阻隔绝DGND和AGND,减少电磁干扰	给MCU的VCC供电,接1uF电容,滤去纹波,电容越接近MCU越好,MCU输入晶振频率大于20Mhz,电容换成0.01uF, 可以同时使用0.01uF和0.1uF,前者更近于MCU,还可以在前面加10uF钽电容,前面可以加电感或小电阻
	磁珠对高频干扰效果特别好
	模拟地 数字地要分开 用0欧姆电阻来连接
	芯片供电要 滤波
```

### 开关电源基本元件:

1电子开关: 

```
IGBT(开关速度不快) 三极管(开关速度慢,压降高) NMOS(开关速度快,压降低)
Iout < 5A 内置 , Iout >5A 外置 外置的NMOS 可以并联 ,N接N, D接D,S接S, 可以增大通过电流,减少Rds(on)
```

2肖特基二极管或快恢复二极管

```
1N4007 1N4148 1N5408 (Silicon diode)
SS14 SS34 SS54 (Schottky diode 肖特基)
(Zener diode 稳压)
1N4007在1KHz一下工作非常好,不能用在开关电源
1N5817 在1.2MHz也能很好工作.
```

3电感

```
直流电阻 DCR
通流能力 Irms
饱和电流 Isat
开发,电流小,成本低->工字电感
电赛->屏蔽电感
电流大->磁环电感(黄白环, 铁硅铝电感)
```

4电容

```
Cin: 需要一个0.1uF的无极性电容并一个有极性电容.比如铝电解电容 
```

```
Cout: 
ESR需要小, 需要一个0.1uF的无极性电容并一个有极性电容.
MLCC X7R (50V 22uF 1206封装)
钽电容 ( 3倍裕量)
固态电容
减少纹波技巧,输入输出都有0.1uF无极性电容并,输出再加LC低通滤波.
当输出用铝电解电容,发现纹波较大,可以再在中间加LC低通滤波
```

BUCK电路

```
PWM纹波控制开关,PWM占空比 D = Ton/T, 
输出电压Vout/输入电压Vin = D
同步整流BUCK电路,效率高于普通BUCK电路
```

### BUCK数值设计

```
Ci耐压,大小
Co耐压,大小
肖特基二极管耐压,电流
电感多大
R1,R2多大

数值设计
Ci Co L D Vo R1 R2
```

开关电源芯片

```
LM2596 LM2576 太贵,淘汰
主要用MPS公司的.
另外还有TI的 TPS5450
看数据手册,重要的 Iout Vin Fsw.EN 和 FB 引脚.
```

```
开关外置,大电流 sw引脚 LC滤波,减少纹波 PMOS过流保护
sw引脚 RC接地,防止NMOS过冲. Cout加磁珠成ΠL滤波 肖特基并RC,防止过冲.
高性价比芯片SX1308 = MT3608
B628开头,芯片一模一样
buck芯片做负电压要避免(LM2596 LM2576),过冲严重
```

```
驱动多串LED
LED串联,手机的LCD屏幕的背光,电流需要一致,所以要串联,用升压电路升到高电压供电.
手电筒,两挡位亮度
台灯
```

```
12v升压到55KV, 反激,变压器,倍压整流,
L1 L2 耦合电感, 需要注意同名端.约5元一片
耦合电感的效率高于非耦合电感.非耦合电感约0.3元一片
推荐非耦合
```

```
Cin 电容 耐压
Cout 电容 耐压
D1 耐压 电流
L1 电感量 饱和电流
R1 R2
ESR小,  固态电容 
```

PCB

```
Co Ci 距离芯片近
R1 R2 距离FB近 距离 开关 L小.
SW周围回路短 大电流铺铜
F1 F2 的宽度8mil,不要太宽
反馈从C2 C3中间走
反馈两遍包地,反馈原理 电感和肖特基
```

## 运放

芯片:

```
减法运算电路: INA143 INA152
仪表放大: AD620 , INA101, INA128
跨导放大器: AD590
采样保持: 通用型 LF398 , AD582  高速型 THS-0025, THC-0300 高分辨率型: SHA1144, AD389
滞回比较器: 通用型 AD790 高速型 MC1414双比较器  低功耗 LM339四比较器 高精度 LM119双比较器
比较器便宜芯片(可以常备) :LM393  LM339 LM311 LC372
RC正弦振荡电路: AD9833
可以带大电容:OPA350
电流低端检测:LN8541
电路高端检测: INA270  INA271
负电压的产生: MC34063 sx1308
单电源供电: TL431
```

比较器参数:

```
供电电压 Vs
传输延时时间 Tpd ,另称为反应时间 (从0跳变到 50%Vs的时间)
静态电流IQ
```

比较器选择:

```
供电电压 Vs
传输延时时间 Tpd, 能够处理的频率上限在 1/(Tpd * 3) 到 1/ (Tpd * 2 ) 间
输出方式(推挽 开漏)
```

### 一,运放参数

1 **供电电压Vs**
2 输入偏置电流IB 	精密
3 噪声Vn		放大小信号
4 静态电流Iq	低功耗
5 输入失调电压Vos
6 输入失调电压温漂 dVos/dT  无所谓
7 **增益带宽积GBW** 
8 **压摆率SR** slew rate
9 输入电压范围
10 输出电压范围
11 短路电流 Isc 
12 运放的输入阻抗  impedance resistance



### 二,选择运放

1供电电压Vs

```
需要留有余裕,  放大后的最大电压 Vmax < Vs.
如果是输出轨到轨RRO,至少留0.2V,如果不是,至少2V.
Vs(max) * 0.8 = Vs(实际供电)
```

2 增益带宽积GBW

```
GBW >= (10~100) * gain * f
gain为放大倍数, f单位为Mhz带入
```

3 压摆率SR

```
SR >= (10~100)2Π* f * Vom
Vom为输出电压幅值,f为输入频率Mhz
```

4 价格和性能

注意:

```
单电源供电,且输入信号很小时,会导致信号放大不正确,
误差极大,微弱信号检测最好的方法是双电源供电.
```

### 三,运放的典型应用

1.1 比例运算电路
1.1.1反向比例运算

```
输入电阻Ri = R, 放大倍数Au = - Rf/ R, 平衡电阻 R` = R//Rf,
精度要求: R和Rf精度要求高,1% 0.1%, R`可有可无, 取消R`引入误差 IB * R` 不大.
缺点, Ri = R, 从取电压角度,R越大越好, 但实际上R太大容易引入噪声.
补救,可以用 高阻型反相比例运算电路 Ri = 运放Ri ~∞
运用: 信号缩小
```

1.1.2同相比例运算电路

```
Ri ~= ∞	 Au = (1 + Rf/R)
注意, 有 Stable in Gain >= x 当 放大比例大于x时,才可以稳定.
运用:信号放大
```

1.1.3 电压跟随器

```
Ri ~= ∞	Au =1
运用:阻抗变换 缓冲级
注意:  unity-Gain stable(单位增益稳定)的可以让 Rf省略,否则最好Rf 不能少,比如Rf取2K欧姆
```

1.2加法运算电路
1.2.1反向加法电路

```
取R` = Rf//R1//R2//..//Rx
```

1.2.2同相加法电路

```
取R = Rf = R1 = R2 = .... = Rx, U0 = Ui1 + Ui2 + ...
运用: 把信号 加上一个电压 UT, 抬升信号,使得可以被 STM32的ADC采集到. 
可以调零运放.
```

1.3减法运算电路

```
取R` = Rf, R = R1 = R2,  U0 = (Rf/R) * (Ui2 - Ui1)
特点: 输入电阻不高, 有共模输入电压,
补足:采用双运放构成减法电路
使用非常广泛
芯片: INA143 INA152
```

1.4积分和微分运算电路

```
反向比例运算电路的 Rf 换为电容C
U0 = (- 1/(RC) )∫uidt
电阻R和电容C调换位置
U0 = -R *C * (dui/ dt)
```

1.5 对数和指数运算电路

```
反向比例运算电路的 Rf 换为三级管D
U0 = -U * T * In( u1/ (R*Is))
电阻R和三级管D调换位置
U0 = -(R * Is) * e ^ ( UI/ UT)
原本是二级管D 但是使用二极管误差大.
```

2.1测量放大电路(仪表放大电路)

```
应用 : 放大从传感器处获得的微弱变换电信号,
构成: A1, A2差分放大, A3 二级差分电路
特点,很强共模抑制能力和较小的漂移电压,较高的差模电压放大倍数
uo = - ( R4/ R3) * (1 + 2 * R2 / R1) * ( Ui1 - Ui2)
芯片: AD620 , INA101, INA128
需要的Rg精度高 0.1%
仪表放大器特别适合于驱动电桥.在Ref脚加入一个直流电压可以将输出电压抬高.
注意: 差分放大器输入脚可以悬空, 仪表放大器的输入不能悬空,必须通过一个电阻R接地.
仪表放大器特别适合于惠斯通桥和人体信号处理.
```

2.2 跨导放大器

```
远距离微弱信号传输.
微弱信号放大,将电压信号转化为恒流源信号,再传送
芯片: AD590
```

2.3采样保持电路

```
Uc高电平采样, 低电平保持, Uc通PWM波来采样保持.
芯片: 通用型 LF398 , AD582 
高速型 THS-0025, THC-0300
高分辨率型: SHA1144, AD389
```

3.1 有源滤波电路

3.1.1低通滤波器
3.1.1.1 一阶低通滤波器

```
截至频率f0 = 1 / ( 2 * 派 * R * C), f0对应为-3dB频率.
一阶低通滤波器的对数放大倍数以20dB/十倍频的速率下降
```

3.1.1.2 二阶低通滤波器

```
f0 = 1 / ( 2 * 派 * R * C)
等效品质因数Q = 1 / (3 - A0),  Q > 0, 即 A0 < 3时电路能稳定工作,否则自激振荡,
要求 Rf < (2 * R1)
二阶低通滤波器的对数放大倍数以40dB/十倍频的速率下降
解决Sallen-Key低通滤波器高频馈通的三个方法:
	选择FET或者CMOS型放大器作为有缘滤波器, IB为 pA级.
	可以先 无源低通, 再有源二阶低通,
	或者先有源二阶低通,再无源低通.
	在反馈回路上加上一个IB小的缓冲器隔离.
```

3.1.2高通滤波器

```
f0 = 1 / ( 2 * 派 * R * C)
Au = 1 + Rb/ RA
```

3.1.3带通滤波器

```
带通比较窄,可以用低通和高通成为一个滤波器.
带通宽的,需要用一个低通滤波和高通滤波来配.
DAPF带通滤波器, 高Q值
```

3.1.4带阻滤波器

```
50Hz或60Hz陷波器,防止电源的交流电影响.
```

3.1.5全通滤波器

```
Au = 1, 移相,延时
```

```
注意:有源滤波器中无源器件的选择
 有缘滤波器一般将电容固定而采用可调电阻来调节中心频率. 这是因为计算出来的与实际的板子有差别.
 电容推荐: NP0电容(不能采用钽电容, 电解电容, 会炸)
 电阻最好选用0.1%精度,25ppm以下的精密电阻.
 做运放的实验准备: 买全套的0805封装的NP0电容, 
全套0805封装,精度0.1%的精密电阻,
买一些好的滑动电阻器
好的信号发生器,示波器
```

滤波器的 运放的 GBW 和 SR选择:

```
MFB结构, GBW > = (10 ~ 100) * Gain * f0
Sallen-key结构, GBW >= X * (10 ~ 100) * Gain * f0, x = max(1 , Q^3) Q为品质因数.
压摆率 SR >= 2 * (10~100) * 2Π* f0 * Vom
```

```
趋势,软件滤波, 用加法器将信号抬高到0轴以上, 用ADC采集以后,数字滤波或者软件滤波.
```

### 四.电压比较器

4.1过零电压比较器
4.2电压比较器

```
Vref 可以用 TL431提供,价格便宜,纹波小
```

4.3窗口比较器

```
Vi 在窗口 Vref1 ,Vref2之间时,输出低电平
```

4.4滞回比较器

```
滞回比较器具有抗干扰作用
集成运放比较器: 通用型 AD790 高速型 MC1414双比较器  低功耗 LM339四比较器 高精度 LM119双比较器
```

```
比较器推挽输出
不用上拉电阻, 不可转换电平
比较器开漏输出 open drain
使用上拉电阻,可以转换为令一个电平
```

比较器参数:

```
供电电压 Vs
传输延时时间 Tpd ,另称为反应时间 (从0跳变到 50%Vs的时间)
静态电流IQ
```

比较器选择:

```
供电电压 Vs
传输延时时间 Tpd, 能够处理的频率上限在 1/(Tpd * 3) 到 1/ (Tpd * 2 ) 间
输出方式(推挽 开漏)
```

```
便宜芯片(可以常备) :LM393  LM339 LM311 LC372
```

题目多功能计数器

```
双二极管(双向限幅)SS14,管压降0.2V,很小,信号可以放更大->
正向比例放大 OPA699->正向比例放大 OPA699->
	{->迟滞比较器TL3161(>1.5Mhz),(下面的为+5V,不为-5V)}
	{->迟滞比较器LM311(<1.5Mhz)}
->两个非门74LVC2G14整形->FPGA

SS14管压降小,信号可以放大更多, 
LM311可以放大频率低(<1.5Mhz)的信号,
TL3161可以放大频率高(>1.5Mhz)的信号.
整形用74LVC2G14,速度快
```

```
张驰震荡电路 用来产生PWM波,
但是也可以根据公式测PWM波来检测电容C,或者电阻R
```

```
注意: 运发与比较器的区别
比较器是一种特殊的运放.
运放可以做比较器,比较器不能做运放. 
运放做比较器速度低.性能远不如便宜的比较器,不划算.

运放不加负反馈时,可以做比较器,但运放开环增益非常高,
只能处理差分电压非常小的信号.响应会慢许多,缺少滞回,内部基准等
```

5.1 RC正弦振荡电路

```
f0 = 1 / ( 2 * 派 * R * C )	起振要求: Rf >= 2 * R1, 增幅稳定要求 Rf = 2 * R1
方法: Rf 为负温度系数NTC电阻 , Rf 又两个反向二级管并联而成 二极管要求速度快, 比如 1N4148
推荐芯片:AD9833
```

5.2 非正弦波产生电路
5.2.1 矩形波产生电路
5.2.2 三角波产生电路
5.2.3 锯齿波产生电路
5.2.4 压控振荡电路
5.2.5 集成函数发生器
5.2.6 驱动电容式负载的接法

```
 OPA350被设计为可以带大电容
```

5.2.7 封值建波 

```
 应用于自动增幅控制AGC,声音大小自动调控
未使用运发推荐接为电压跟随器 或者 正向输入接Vdd, 反向输入接-Vdd
```

6.1电流低端检测 

```
LN8541仿照AD8541,性能几乎一致
LN8541 0.5元  AD8541 2元
取样电阻的大小最好为10欧姆,
取样电阻的电阻最好不随温度变化, 材质锰铜 > 康铜 > 其他
```

6.2 电路高端检测 

```
up常用芯片 INA270 放大倍数为14, INA271放大倍数为20 
Vout = I0 * Rs * 14 (IN270),供电电压看输出接的ADC的芯片,供3.3V或5.0V, Rs由0.9 * Vout最大来反推.一般为20m欧姆
```

### 五,运发的供电

纹波ripple的害处:

```
1.容易在电器上产生谐波,谐波会产生较多的危害.
2,降低了电源的效率
3.较强的纹波会造成浪涌电压或电流的产生,导致烧毁用电器.
4.会干扰数字电路的逻辑关系,影响其正常工作
5.会带来噪声干扰,使图像设备,音响设备不能正常工作.
```

```
线性电源 电路简单 效率低 发热大, 功耗高, 纹波小
开关电源 电路复杂 效率高 发热小 功耗低 纹波大
```

```
同时兼顾效率和纹波:		(buck电路后接线性电源电路)Buck芯片为同步整流效率高, 后面的线性降压的管压降小,效率高,
分别可以选 MP2307, TPS7A4700,
如果要便宜一点,可以选TPS5450和7805
```

纹波对运发的影响:		

```
纹波会造成运放静态工作点偏移从而使运放放大信号时结果不准确.
纹波不能消除,只能减少,在运放供电中 纹波越小越好. 
1.可以使用电容倍增器来减少纹波:	电容倍增器 达林顿管基极加上一个电容,达林顿管再并一个电阻
C(总体) = β(达林顿管) * C(电容)
2.给运发供电时可以采用ΠLC供电,其中电感可以用磁珠,或用电阻替代.
电容越小越靠近运发供电, 钽电容需要留有一倍裕量, 有极性电容需要注意方向, 芯片频率抬高,需要减小旁路电容大小, 库电容至少是旁路电容的10倍
```

负电压的产生:

```
1.电荷泵ICL7660 ICL7662:	效率高,输出电流小, 贵(4元),淘宝容易有假的.
TL1054: 效率高, 输出电流有100mA, 贵(45元)
2. 推荐MC34063, 便宜(总的不到1元) 但体积会大, 数据手册可以看中文,但原理图框看英文
3.Buck 电路输出负电压: 输出接地, 地连起来接输出,  不能用LM2576, LM2596, 上电瞬间电压猛增
4.多路升压输出,负电压输出.boost电路生成负电压, sx1308(0.35元)
5.flybuck 但是耦合电感太贵(5元一片),不推荐
```



```
运放单电源供电和双电源供电差别不大,只是在放大小信号的时候,单电源误差更大.
```

运发的单电源供电:

```
所有运放理论上都可以单或者双电源供电, 单电源供电会对放大微小信号引入更多误差.同时电流反馈型运放不建议单电源供电
单电源供电的运发在手持设备, 低电压设备和ADC驱动中非常常见,电池供电等场合特别适合单电源供电
单电源运放的设计要点是偏置电压的设定
基本原则:制造虚地,注意隔直 , 虚地为VCC/2最好,可以让交流电放大的空间更大
```

注意: 

```
仪表放大器的Vref不应该由电阻分压供电,电量太小,不容易驱动里面的几个运放
可以用电阻分压,二级为电压跟随器,来获取电流大的基准电压.
进一步可以为电压跟随器做去耦处理
再进一步可以做成低通滤波器
```

单电源供电运放的注意事项

```
单电源供电的两个缺点: 输出小信号时误差较大, 能处理的频率较低 <= 100Khz
单电源供电的最大问题是输出小电压的时候误差很大, 最好的方法是双电源供电, 负电源给一个-0.2V都够了,但是一定要有负电源.
DAC的运放输出基本都是单电源供电,导致输出不准确.
解决方法: C8051F410 作为12位ADC, 输出是由交给我们设计的, 串联一个电阻到底,再加同相比例放大, 运放选OPA350效果最好,因为OPA350可以带大电容负载
双电源供电是否要对称?比如-+5V?
放大直流,可以用-0.2V接负极供电, 放大交流,需要考虑输出是否被削底
```

### 六,电流反馈型运放

```
电压反馈型宽带放大器 (VFB) voltage feedback Amplifier
电流反馈型放大器 (CFB) current feedback Amplifier
电压控制增益可调放大器 (VCA) voltage controlled Amplifier
全差分放大器 (FDA) Fully Differential Amplifier
中射频放大和调制器 IF/RF Amplifer & Modulator
```

高速运算放大器: 

```
应用于 快速A/D和 D/A转换器, 视频放大器中.
特点, SR高, BWG大.
宽带~决定了放大小信号时,运放大速度
压摆率~衡量大信号通路时,运放的输出能否及时响应快速变化输入信号的指标.
高速运算放大器大都用电流反馈方法.
```

```
解决过冲问题, 反馈电阻Rf并联一个4.7pf NP0电容 形成一个低通滤波器,这对电压反馈运放VFB 有效.
电流反馈运放的过冲是反馈电阻选的不对,不能过大,不能过小, 需要仔细看data sheet, 电压反馈型的Rf电阻的大小不影响,电流反馈型运放在使用时需要小心
```

```
在低速精密信号调理中,电压反馈放大器,
在高速信号调理中,电流反馈放大器(gain >= 4 或信号频率大于10Mhz)
```

宽带直流放大器

```
输入缓冲+宽带压控增益放大+宽带功率驱动
高速运放为了点少寄生电容对带宽的影响,输入阻抗会大大减小;采用高速Bipolar放大器
```

高速放大电路布局布线

```
高速放大电路 反相输入端不能接电容,否则振荡, 如果不接电容,也会有寄生电容导致振荡
距离挖空区域至少30mil, 不能有地,电源,敷铜, 走线
有条件的话加屏蔽罩,放在铝合金的盒子里面.
第一级输入不允许有过孔, 第一极输出到第二级输入要尽可能短,要无过大过孔,实在不行可以用屏蔽西线
输入信号一定要用SMA接口,使用屏蔽线, 接口有时需要阻抗匹配电阻

从左到右: 磁珠去高频干扰, 双向二极管1N4148限幅提供更大放大空间同时作为保护,电容高通, VccΠLC滤波供电成为VDD, 右边VDD分压后,进入电压跟随器, 做去耦处理, 给Vref供电, Vout 做高通滤波除去直流分量.
所有宽带放大器全部同相比例
OPA847->VCA824->THS3201->THS3091
这里的滤波器需要用空心电感(频率太高,C需要比较小)可以参考<<LC滤波器设计与制作图解实用电子技术丛书 (森荣二) >>自己用漆包线来制作电感.
同时这里的滤波器在如此高频率的条件下,只能选用无源滤波电路

输出的电流不够大的话,可以用两个芯片并联增加电流.

 给芯片的Vcc引脚供电需要注意的是,在这么高的频率下,0.1uF变成了感性,不能滤波,最好同时并0.1uF,0.01uF,470pF来滤掉不同频段的高频信号.
```

运放使用中的注意事项:

```
注意输入电压是否超限
不要在运放输出直接并接电容,除了OPA350
不要在放大电路反馈回路并接电容(VIN-接电容到地), 反馈电阻Rf可以于0.1uF电容并(除了电流反馈回路).
注意运放的输出摆幅,需要留有净空.
注意反馈回路的Layout, Vin-,Vout, 反馈回路要接近, 线要短,线要圆角,不要直角, 避开高频干扰, 地和电源不要敷铜(30mil)
要重视电源滤波, 从电源到芯片VCC, 10uF钽电容, 磁珠,0.1uF电容,470pF电容, 构成ΠLC滤波电路,  470pF电容抵在VCC引脚, 钽电容远离VCC引脚.
可以挖空地后,用线(6mil)绕Vin-, Vout一圈, 作为保护环.保护环连接到Vref上
```

### 七,RMS-DC转换器, 有效值测量芯片

```
有极性电容的正正相连,或负负相连,就成为一个无极性电容. 这是获得Vi的有效值的电路
芯片太贵,用不起.
万用表上的AD-DC转换电路:
使用放大器, LM2904, 输入3V有效值的AC, 调滑动变阻器,如果获得3V输出,用胶水粘住滑动变阻器,就比较准了.UT58A
```

### 八,模拟开关于多路复用器

```
模拟开关工艺: JFER, CMOS
JEFT主要受Vgs影响, 
 CMOS受Vgs和温度影响,T上升Ron上升, Vgs上升Ron下降
```

开关有寄生电容,隔直通交

```
三个模拟开关杜绝泄露, 成本高  输入频率高频率高,泄露严重.
```

开关选择:

```
供电电压Vs(单电源,双电源)[单电源开关不可以通过交流]
导通电阻Ron
开关拓扑
```

## 常见电子元器件

### 电阻

电阻参数:

```
精度: 0.1% 1% 5% 10% 15% 25%
L = 0.01% P = 0.02% W = 0.05% B = 0.1% C = 0.25% D = 0.5% F = 1%
G = 2% J = 5% K = 10% M = 20% N = 30%
```

温度系数: 

```
PPM
PPM * 阻值 * 变化温度(25为基准)
```

功率: 

```
0402 1/16W
0603 1/10W
0805 1/8W
1206 1/4W
1210 1/3W
2010 3/4W
2512 1W
```

电阻应用:

```
限流
分压
匹配阻抗
测量
```

电阻技巧

```
未知阻值电阻(多个电阻串并联以方便调整阻值)
电阻发烫(并联增加功率 铺铜 散热孔增加散热)
电阻太多占地方(使用排阻)
零欧姆电阻{
跳线
分割数字地和模拟地, 抑制环路电流以抑制噪声
保险丝用,不推荐但可省成本
测试预留用
开关用(导通与否)
}
```

购买

```
电阻本	1%精度 170种 0805规格 贴片电阻
```

### 电容

```
ESR:MLCC(X7R>x5R) > 钽电容 > 固态电容 > 高频低阻电解 > 电解
```

功能:

```
蓄电 
平滑 平滑电压变动
去耦 对高频旁路滤波走(去交流)
耦合 隔直通交(取交流)
```

静电电容量

```
积层陶瓷电容器: 1pF~100uF(0~8)
铝电解电容:100nF~10mF(6~10)
钽电解电容:100nF~1mF(6~9)
薄膜电容:100pF~100uF(2~8)
```

频率

```
电解电容:100hz~100Khz(音响,调幅广播)
薄膜电容:100hz~100Khz(音响,调幅广播)
积层陶瓷电容器:100Khz~1ghz(调幅广播,短波广播,调频,电视,手机,卫星)
```

MLCC分类(积层陶瓷电容器)

```
C0G,NP0: 高温度补偿特性, 旁路电容 耦合电容
X7R:温度稳定型, 要求不高
Z5U:小尺寸,低成本,去耦电路
Y5V:温度特性差,容量大,代替低容量铝电解电容
```

MLCC注意:

```
MLCC在两年后会有0.1~0.2的容值递减
MLCC有小电容和低ESR,做电源的输入滤波电容器时,会容易与输入互联电感谐振.造成约2VCC过压
电容电压变化时,物理尺寸会变,产生噪声.(可以使用NPO, 电容远离边界)
```

铝电解电容

```
特点:
	电容大,便宜,有极性(有标记的为负极)
	电解液蒸发,泄露, 易燃
作用:
	隔直通交
	旁路(去耦) 耦合 滤波 温度补偿 计时(t=RC) 调谐 整流 储能
主要参数:
	等效串联电阻ESR:越低越好
	漏电流:越小越好 工作电压为2/3的额定电压来选, 额定电压大,漏电流小
	静电容量, 工作电, 温度
	损耗:发热形式的能量损耗
	频率特性: 频率上升,电容下降
	
注意:
	避免:反向电压, 过压, 纹波过额定值 急速充放电
```

钽电容

```
特点:
	寿命长, 耐高温,准确度高, 耐电压电流能力较弱, 电路大容量滤波.
	价格较贵
主要参数:
	额定容量: 
	损耗:直流偏压*漏电流 + 纹波电流 * ESR
	直流漏电流:最重要
	ESR等效串联电阻:
	(漏电流,ESR > 损耗 > 容量精度)
用途:
	电源滤波, 交流旁路
注意:
	有标记的为+极
	有极性,反接会爆炸
	工作电压选额定电压的1/3~1/2
	纹波不要超了
```

固态电容

```
铝电解电容升级版
	高稳定性, 寿命长, 低ESR, 高额定纹波电流
```

可变电容

```
场景:
	收音机, 电视机, NFC/RFID读卡器,电子仪器,高频信号发生器,通信设备
作用:
	调谐, 补偿电容器, 校正电容器
特点:
	精准,介质损耗小(Q值高),稳定性好,寿命长,体积大,绝缘电阻高
```

### 电感

```
主要参数:
	通流能力(Irms),饱和电流(Isat),精度, 直流电阻(DCR),自谐振频率(SRF)
	电感单位 uH
	中周, 黄百环, 铁硅铝, 磁珠
```

### 二极管

```
主要参数:
	最大整流电流If
	最大反向工作电压Ur
	反向电流Ir
	最高工作频率Fm(频率越大,结电容越大)
应用:
	整流,检波,限幅,元件保护
单相整流电路
	1.5~2裕量(选择电压)
	T = RC >(3~5)T/2
稳压管
	稳压值Uz
	稳定电流Iz
	额定功耗Pz
二极管作用
	电感续流
	防反接
	给电感续流
	限幅
整流二极管:1N5819 1N5822 1N5825
(低压)肖特基二极管:SS14 SS34 SS54
(高压)快恢复二极管:FR107 FR207 FR307 1N4007
```

### 三极管

```
作用:放大和开关
共射 共集 共基
常用三极管型号:
9012 PNP 0.5A 25V
9013 NPN 0.5A 25V
S8050 NPN 0.5A 25V
S8550 PNP 0.5A 25V
SS8050 NPN 1A 25V
SS8550 PNP 1A 25V
```

### MOS管

```
寄生二极管
作用:开关作用 隔离作用 可调电阻
LM2596
NMOS参数
	VDSS 最大V(d-s) 裕量20%
	VGS 最大V(g-s)
	ID 连续漏电流 裕量20%
	VGS(th)
	RDS(on)导通电阻 
	Ciss:输入电容
	导通损耗和开关损耗
常用MOS管
IRF540
IRF640
IRF840
SI2301
SI2302
2N7002
```

## 其他

### 单词

```
功率 power
电压 voltage
电流 current
频率 frequency
效率 efficiency
波形 waveform
交流 alternating-current
直流 direct-current
适配器 adaptor
转换器 converter
逆变器 inverter
充电器 charger
控制器 controller
启动器 jump starter
器件 device
元件 component
电容器 capacitor
电阻 resister
电感 inductor
二极管 diode
稳压二极管 zener
三级管 audion
场效应管 MOSFEET
变压器 transformer
光耦 optical coupler
保险丝 fuse
半导体 semiconductor
瓷片电容 ceramic capacitor
电解电容 electrolytic C
电感 inductance
电容 capacitance
电阻 resistance
感性的 inductive
容性 capacitive
阻性 resistive
阻抗 impedance
```

### 书籍推荐

```
op放大电路设计
牛人图解DIY1pA超微电流测试器
OP放大器应用技巧100例
超声波传感器应用指南
德州仪器高性能模拟器件高校应用指南
```

