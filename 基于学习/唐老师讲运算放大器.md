## 运放

芯片:

```
减法运算电路: INA143 INA152
仪表放大: AD620 , INA101, INA128
跨导放大器: AD590
采样保持:
通用型 LF398 , AD582 
高速型 THS-0025, THC-0300
高分辨率型: SHA1144, AD389
滞回比较器: 通用型 AD790 高速型 MC1414双比较器  低功耗 LM339四比较器 高精度 LM119双比较器
比较器便宜芯片(可以常备) :LM393  LM339 LM311 LC372
RC正弦振荡电路: AD9833
可以带大电容:OPA350
电流低端检测:LN8541
电路高端检测: INA270  INA271
负电压的产生: MC34063 sx1308
单电源供电: TL431
```

比较器参数:

```
供电电压 Vs
传输延时时间 Tpd ,另称为反应时间 (从0跳变到 50%Vs的时间)
静态电流IQ
```

比较器选择:

```
供电电压 Vs
传输延时时间 Tpd, 能够处理的频率上限在 1/(Tpd * 3) 到 1/ (Tpd * 2 ) 间
输出方式(推挽 开漏)
```

### 一,运放参数

1 **供电电压Vs**
2 输入偏置电流IB 	精密
3 噪声Vn		放大小信号
4 静态电流Iq	低功耗
5 输入失调电压Vos
6 输入失调电压温漂 dVos/dT  无所谓
7 **增益带宽积GBW** 
8 **压摆率SR** slew rate
9 输入电压范围
10 输出电压范围
11 短路电流 Isc 
12 运放的输入阻抗  impedance resistance



### 二,选择运放

1供电电压Vs

```
需要留有余裕,  放大后的最大电压 Vmax < Vs.
如果是输出轨到轨RRO,至少留0.2V,如果不是,至少2V.
```

2 增益带宽积GBW

```
GBW >= (10~100) * gain * f
gain为放大倍数, f单位为Mhz带入
```

3 压摆率SR

```
SR >= (10~100)2Π* f * Vom
Vom为输出电压幅值,f为输入频率Mhz
```

4 价格和性能

注意:

```
单电源供电,且输入信号很小时,会导致信号放大不正确,
误差极大,微弱信号检测最好的方法是双电源供电.
```

### 三,运放的典型应用

1.1 比例运算电路
1.1.1反向比例运算

```
输入电阻Ri = R, 放大倍数Au = - Rf/ R, 平衡电阻 R` = R//Rf,
精度要求: R和Rf精度要求高,1% 0.1%, R`可有可无, 取消R`引入误差 IB * R` 不大.
缺点, Ri = R, 从取电压角度,R越大越好, 但实际上R太大容易引入噪声.
补救,可以用 高阻型反相比例运算电路 Ri = 运放Ri ~∞
运用: 信号缩小
```

1.1.2同相比例运算电路

```
Ri ~= ∞	 Au = (1 + Rf/R)
注意, 有 Stable in Gain >= x 当 放大比例大于x时,才可以稳定.
运用:信号放大
```

1.1.3 电压跟随器

```
Ri ~= ∞	Au =1
运用:阻抗变换 缓冲级
注意:  unity-Gain stable(单位增益稳定)的可以让 Rf省略,否则最好Rf 不能少,比如Rf取2K欧姆
```

1.2加法运算电路
1.2.1反向加法电路

```
取R` = Rf//R1//R2//..//Rx
```

1.2.2同相加法电路

```
取R = Rf = R1 = R2 = .... = Rx, U0 = Ui1 + Ui2 + ...
运用: 把信号 加上一个电压 UT, 抬升信号,使得可以被 STM32的ADC采集到. 
可以调零运放.
```

1.3减法运算电路

```
取R` = Rf, R = R1 = R2,  U0 = (Rf/R) * (Ui2 - Ui1)
特点: 输入电阻不高, 有共模输入电压,
补足:采用双运放构成减法电路
使用非常广泛
芯片: INA143 INA152
```

1.4积分和微分运算电路

```
反向比例运算电路的 Rf 换为电容C
U0 = (- 1/(RC) )∫uidt
电阻R和电容C调换位置
U0 = -R *C * (dui/ dt)
```

1.5 对数和指数运算电路

```
反向比例运算电路的 Rf 换为三级管D
U0 = -U * T * In( u1/ (R*Is))
电阻R和三级管D调换位置
U0 = -(R * Is) * e ^ ( UI/ UT)
原本是二级管D 但是使用二极管误差大.
```

2.1测量放大电路(仪表放大电路)

```
应用 : 放大从传感器处获得的微弱变换电信号,
构成: A1, A2差分放大, A3 二级差分电路
特点,很强共模抑制能力和较小的漂移电压,较高的差模电压放大倍数
uo = - ( R4/ R3) * (1 + 2 * R2 / R1) * ( Ui1 - Ui2)
芯片: AD620 , INA101, INA128
需要的Rg精度高 0.1%
仪表放大器特别适合于驱动电桥.在Ref脚加入一个直流电压可以将输出电压抬高.
注意: 差分放大器输入脚可以悬空, 仪表放大器的输入不能悬空,必须通过一个电阻R接地.
仪表放大器特别适合于惠斯通桥和人体信号处理.
```

2.2 跨导放大器

```
远距离微弱信号传输.
微弱信号放大,讲电压信号转化为恒流源信号,再传送
芯片: AD590
```

2.3采样保持电路

```
Uc高电平采样, 低电平保持, Uc通PWM波来采样保持.
芯片: 通用型 LF398 , AD582 
高速型 THS-0025, THC-0300
高分辨率型: SHA1144, AD389
```

3.1 有源滤波电路

3.1.1低通滤波器
3.1.1.1 一阶低通滤波器

```
截至频率f0 = 1 / ( 2 * 派 * R * C), f0对应为-3dB频率.
一阶低通滤波器的对数放大倍数以20dB/十倍频的速率下降
```

3.1.1.2 二阶低通滤波器

```
f0 = 1 / ( 2 * 派 * R * C)
等效品质因数Q = 1 / (3 - A0),  Q > 0, 即 A0 < 3时电路能稳定工作,否则自激振荡,
要求 Rf < (2 * R1)
二阶低通滤波器的对数放大倍数以40dB/十倍频的速率下降
解决Sallen-Key低通滤波器高频馈通的三个方法:
	选择FET或者CMOS型放大器作为有缘滤波器, IB为 pA级.
	可以先 无源低通, 再有源二阶低通,
	或者先有源二阶低通,再无源低通.
	在反馈回路上加上一个IB小的缓冲器隔离.
```

3.1.2高通滤波器

```
f0 = 1 / ( 2 * 派 * R * C)
Au = 1 + Rb/ RA
```

3.1.3带通滤波器

```
带通比较窄,可以用低通和高通成为一个滤波器.
带通宽的,需要用一个低通滤波和高通滤波来配.
DAPF带通滤波器, 高Q值
```

3.1.4带阻滤波器

```
50Hz或60Hz陷波器,防止电源的交流电影响.
```

3.1.5全通滤波器

```
Au = 1, 移相,延时
```

```
注意:有源滤波器中无源器件的选择
 有缘滤波器一般将电容固定而采用可调电阻来调节中心频率. 这是因为计算出来的与实际的板子有差别.
 电容推荐: NP0电容(不能采用钽电容, 电解电容, 会炸)
 电阻最好选用0.1%精度,25ppm以下的精密电阻.
 做运放的实验准备: 买全套的0805封装的NP0电容, 
全套0805封装,精度0.1%的精密电阻,
买一些好的滑动电阻器
好的信号发生器,示波器
```

滤波器的 运放的 GBW 和 SR选择:

```
MFB结构, GBW > = (10 ~ 100) * Gain * f0
Sallen-key结构, GBW >= X * (10 ~ 100) * Gain * f0, x = max(1 , Q^3) Q为品质因数.
压摆率 SR >= 2 * (10~100) * 2Π* f0 * Vom
```

```
趋势,软件滤波, 用加法器将信号抬高到0轴以上, 用ADC采集以后,数字滤波或者软件滤波.
```

### 四.电压比较器

4.1过零电压比较器
4.2电压比较器

```
Vref 可以用 TL431提供,价格便宜,纹波小
```

4.3窗口比较器

```
Vi 在窗口 Vref1 ,Vref2之间时,输出低电平
```

4.4滞回比较器

```
滞回比较器具有抗干扰作用
集成运放比较器: 通用型 AD790 高速型 MC1414双比较器  低功耗 LM339四比较器 高精度 LM119双比较器
```

```
比较器推挽输出
不用上拉电阻, 不可转换电平
比较器开漏输出 open drain
使用上拉电阻,可以转换为令一个电平
```

比较器参数:

```
供电电压 Vs
传输延时时间 Tpd ,另称为反应时间 (从0跳变到 50%Vs的时间)
静态电流IQ
```

比较器选择:

```
供电电压 Vs
传输延时时间 Tpd, 能够处理的频率上限在 1/(Tpd * 3) 到 1/ (Tpd * 2 ) 间
输出方式(推挽 开漏)
```

```
便宜芯片(可以常备) :LM393  LM339 LM311 LC372
```

题目多功能计数器

```
双二极管(双向限幅)SS14,管压降0.2V,很小,信号可以放更大->
正向比例放大 OPA699->正向比例放大 OPA699->
	{->迟滞比较器TL3161(>1.5Mhz),(下面的为+5V,不为-5V)}
	{->迟滞比较器LM311(<1.5Mhz)}
->两个非门74LVC2G14整形->FPGA

SS14管压降小,信号可以放大更多, 
LM311可以放大频率低(<1.5Mhz)的信号,
TL3161可以放大频率高(>1.5Mhz)的信号.
整形用74LVC2G14,速度快
```

```
张驰震荡电路 用来产生PWM波,
但是也可以根据公式测PWM波来检测电容C,或者电阻R
```

```
注意: 运发与比较器的区别
比较器是一种特殊的运放.
运放可以做比较器,比较器不能做运放. 
运放做比较器速度低.性能远不如便宜的比较器,不划算.

运放不加负反馈时,可以做比较器,但运放开环增益非常高,
只能处理差分电压非常小的信号.响应会慢许多,缺少滞回,内部基准等
```

5.1 RC正弦振荡电路

```
f0 = 1 / ( 2 * 派 * R * C )	起振要求: Rf >= 2 * R1, 增幅稳定要求 Rf = 2 * R1
方法: Rf 为负温度系数NTC电阻 , Rf 又两个反向二级管并联而成 二极管要求速度快, 比如 1N4148
推荐芯片:AD9833
```

5.2 非正弦波产生电路
5.2.1 矩形波产生电路
5.2.2 三角波产生电路
5.2.3 锯齿波产生电路
5.2.4 压控振荡电路
5.2.5 集成函数发生器
5.2.6 驱动电容式负载的接法

```
 OPA350被设计为可以带大电容
```

5.2.7 封值建波 

```
 应用于自动增幅控制AGC,声音大小自动调控
未使用运发推荐接为电压跟随器 或者 正向输入接Vdd, 反向输入接-Vdd
```

6.1电流低端检测 

```
LN8541仿照AD8541,性能几乎一致
LN8541 0.5元  AD8541 2元
取样电阻的大小最好为10欧姆,
取样电阻的电阻最好不随温度变化, 材质锰铜 > 康铜 > 其他
```

6.2 电路高端检测 

```
up常用芯片 INA270 放大倍数为14, INA271放大倍数为20 
Vout = I0 * Rs * 14 (IN270),供电电压看输出接的ADC的芯片,供3.3V或5.0V, Rs由0.9 * Vout最大来反推.一般为20m欧姆
```

### 五,运发的供电

纹波ripple的害处:

```
1.容易在电器上产生谐波,谐波会产生较多的危害.
2,降低了电源的效率
3.较强的纹波会造成浪涌电压或电流的产生,导致烧毁用电器.
4.会干扰数字电路的逻辑关系,影响其正常工作
5.会带来噪声干扰,使图像设备,音响设备不能正常工作.
```

```
线性电源 电路简单 效率低 发热大, 功耗高, 纹波小
开关电源 电路复杂 效率高 发热小 功耗低 纹波大
```

```
同时兼顾效率和纹波:		(buck电路后接线性电源电路)Buck芯片为同步整流效率高, 后面的线性降压的管压降小,效率高,
分别可以选 MP2307, TPS7A4700,
如果要便宜一点,可以选TPS5450和7805
```

纹波对运发的影响:		

```
纹波会造成运放静态工作点偏移从而使运放放大信号时结果不准确.
纹波不能消除,只能减少,在运放供电中 纹波越小越好. 
1.可以使用电容倍增器来减少纹波:	电容倍增器 达林顿管基极加上一个电容,达林顿管再并一个电阻
C(总体) = β(达林顿管) * C(电容)
2.给运发供电时可以采用ΠLC供电,其中电感可以用磁珠,或用电阻替代.
电容越小越靠近运发供电, 钽电容需要留有一倍裕量, 有极性电容需要注意方向, 芯片频率抬高,需要减小旁路电容大小, 库电容至少是旁路电容的10倍
```

负电压的产生:

```
1.电荷泵ICL7660 ICL7662:	效率高,输出电流小, 贵(4元),淘宝容易有假的.
TL1054: 效率高, 输出电流有100mA, 贵(45元)
2. 推荐MC34063, 便宜(总的不到1元) 但体积会大, 数据手册可以看中文,但原理图框看英文
3.Buck 电路输出负电压: 输出接地, 地连起来接输出,  不能用LM2576, LM2596, 上电瞬间电压猛增
4.多路升压输出,负电压输出.boost电路生成负电压, sx1308(0.35元)
5.flybuck 但是耦合电感太贵(5元一片),不推荐
```



```
运放单电源供电和双电源供电差别不大,只是在放大小信号的时候,单电源误差更大.
```

运发的单电源供电:

```
所有运放理论上都可以单或者双电源供电, 单电源供电会对放大微小信号引入更多误差.同时电流反馈型运放不建议单电源供电
单电源供电的运发在手持设备, 低电压设备和ADC驱动中非常常见,电池供电等场合特别适合单电源供电
单电源运放的设计要点是偏置电压的设定
基本原则:制造虚地,注意隔直 , 虚地为VCC/2最好,可以让交流电放大的空间更大
```

注意: 

```
仪表放大器的Vref不应该由电阻分压供电,电量太小,不容易驱动里面的几个运放
可以用电阻分压,二级为电压跟随器,来获取电流大的基准电压.
进一步可以为电压跟随器做去耦处理
再进一步可以做成低通滤波器
```

单电源供电运放的注意事项

```
单电源供电的两个缺点: 输出小信号时误差较大, 能处理的频率较低 <= 100Khz
单电源供电的最大问题是输出小电压的时候误差很大, 最好的方法是双电源供电, 负电源给一个-0.2V都够了,但是一定要有负电源.
DAC的运放输出基本都是单电源供电,导致输出不准确.
解决方法: C8051F410 作为12位ADC, 输出是由交给我们设计的, 串联一个电阻到底,再加同相比例放大, 运放选OPA350效果最好,因为OPA350可以带大电容负载
双电源供电是否要对称?比如-+5V?
放大直流,可以用-0.2V接负极供电, 放大交流,需要考虑输出是否被削底
```

### 六,电流反馈型运放

```
电压反馈型宽带放大器 (VFB) voltage feedback Amplifier
电流反馈型放大器 (CFB) current feedback Amplifier
电压控制增益可调放大器 (VCA) voltage controlled Amplifier
全差分放大器 (FDA) Fully Differential Amplifier
中射频放大和调制器 IF/RF Amplifer & Modulator
```

高速运算放大器: 

```
应用于 快速A/D和 D/A转换器, 视频放大器中.
特点, SR高, BWG大.
宽带~决定了放大小信号时,运放大速度
压摆率~衡量大信号通路时,运放的输出能否及时响应快速变化输入信号的指标.
高速运算放大器大都用电流反馈方法.
```

```
解决过冲问题, 反馈电阻Rf并联一个4.7pf NP0电容 形成一个低通滤波器,这对电压反馈运放VFB 有效.
电流反馈运放的过冲是反馈电阻选的不对,不能过大,不能过小, 需要仔细看data sheet, 电压反馈型的Rf电阻的大小不影响,电流反馈型运放在使用时需要小心
```

```
在低速精密信号调理中,电压反馈放大器,
在高速信号调理中,电流反馈放大器(gain >= 4 或信号频率大于10Mhz)
```

宽带直流放大器

```
输入缓冲+宽带压控增益放大+宽带功率驱动
高速运放为了点少寄生电容对带宽的影响,输入阻抗会大大减小;采用高速Bipolar放大器
```

高速放大电路布局布线

```
高速放大电路 反相输入端不能接电容,否则振荡, 如果不接电容,也会有寄生电容导致振荡
距离挖空区域至少30mil, 不能有地,电源,敷铜, 走线
有条件的话加屏蔽罩,放在铝合金的盒子里面.
第一级输入不允许有过孔, 第一极输出到第二级输入要尽可能短,要无过大过孔,实在不行可以用屏蔽西线
输入信号一定要用SMA接口,使用屏蔽线, 接口有时需要阻抗匹配电阻

从左到右: 磁珠去高频干扰, 双向二极管1N4148限幅提供更大放大空间同时作为保护,电容高通, VccΠLC滤波供电成为VDD, 右边VDD分压后,进入电压跟随器, 做去耦处理, 给Vref供电, Vout 做高通滤波除去直流分量.
所有宽带放大器全部同相比例
OPA847->VCA824->THS3201->THS3091
这里的滤波器需要用空心电感(频率太高,C需要比较小)可以参考<<LC滤波器设计与制作图解实用电子技术丛书 (森荣二) >>自己用漆包线来制作电感.
同时这里的滤波器在如此高频率的条件下,只能选用无源滤波电路

输出的电流不够大的话,可以用两个芯片并联增加电流.

 给芯片的Vcc引脚供电需要注意的是,在这么高的频率下,0.1uF变成了感性,不能滤波,最好同时并0.1uF,0.01uF,470pF来滤掉不同频段的高频信号.
```

运放使用中的注意事项:

```
注意输入电压是否超限
不要在运放输出直接并接电容,除了OPA350
不要在放大电路反馈回路并接电容(VIN-接电容到地), 反馈电阻Rf可以于0.1uF电容并(除了电流反馈回路).
注意运放的输出摆幅,需要留有净空.
注意反馈回路的Layout, Vin-,Vout, 反馈回路要接近, 线要短,线要圆角,不要直角, 避开高频干扰, 地和电源不要敷铜(30mil)
要重视电源滤波, 从电源到芯片VCC, 10uF钽电容, 磁珠,0.1uF电容,470pF电容, 构成ΠLC滤波电路,  470pF电容抵在VCC引脚, 钽电容远离VCC引脚.
可以挖空地后,用线(6mil)绕Vin-, Vout一圈, 作为保护环.保护环连接到Vref上
```

### 七,RMS-DC转换器, 有效值测量芯片

```
有极性电容的正正相连,或负负相连,就成为一个无极性电容. 这是获得Vi的有效值的电路
芯片太贵,用不起.
万用表上的AD-DC转换电路:
使用放大器, LM2904, 输入3V有效值的AC, 调滑动变阻器,如果获得3V输出,用胶水粘住滑动变阻器,就比较准了.UT58A
```

### 八,模拟开关于多路复用器

```
模拟开关工艺: JFER, CMOS
JEFT主要受Vgs影响, 
 CMOS受Vgs和温度影响,T上升Ron上升, Vgs上升Ron下降
```

开关有寄生电容,隔直通交

```
三个模拟开关杜绝泄露, 成本高  输入频率高频率高,泄露严重.
```

开关选择:

```
供电电压Vs(单电源,双电源)[单电源开关不可以通过交流]
导通电阻Ron
开关拓扑
```

