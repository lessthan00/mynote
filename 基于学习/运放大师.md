运放大师(1)供电 去耦 PCB设计

```
Vs(max) * 0.8 来取用

滤波 10uF(库电容) 0.1uF 6.8uF(去耦电容)

滤波 50欧姆 串( 10uF 0.1uF 470pF) 形成低通滤波器.
运放处理信号 < 10Mhz,最小的 0.1uF
运放处理信号 > 10Mhz,最小的 0.01uF
处理小信号时,双电源供电,避免削底.
LM7705可以提供 -0.2V的负电压
V+ V-之间, 0.1uF的电容,去除高频偶次谐波.
V+ GND或 V- GND之间, 0.1uF电容,去除谐波.
小电容靠近VDD VEE, 大的库电容原理VDD VEE.

反相输入端-IN的面积最小,这里高阻抗,容易耦合干扰信号
```

运放大师(2)分析 典型电路

```
Ri越大 越能获取电压, Ri越小,越能获取电流, Ri = Rs(电源的内阻),最能获取功率.
反相比例放大器, Ri = R, 比较小, R由并联产生,可以减少噪声.
同相比例放大器, Ri->∞, Ro比较小,经常放在前面用于获取电压.

阻抗匹配, 同相比例放大器前面并一个电阻R = Rs(电源内阻),可以匹配阻抗,获取最大功率.

推荐书籍 <OP放大电路设计>
同相比例最讨厌的地方是容易带入共模干扰
一般使用反相比例
Rf可以并上一个电容,低通滤波器.fo = 1/(2*pai * Rf * Cf). fo频率不宜太小, 比如运放1Khz的方波, 可以保留17Khz以下的波.
反相加法比较好,无共模输入信号.
反相加法,电压源抬升信号源,通过运放,低通滤波.

运放PCB注意:
1.运放的反相 IN- 的杂散电容最容易引起振荡, IN-不应该接电容到地, 同时敷铜距离 30mil. 
2.运放的输出 OUT 不能带容性负载,最好串一个20欧姆电阻.
3.运放供电 10UF库电容 0.1uF去耦电容 470pF去耦电容, 再串一个电阻,低通滤波.
4.Rf并一个Cf,低通滤波器.fo = 1/(2*pai * Rf * Cf). fo频率不宜太小, 比如运放1Khz的方波, 可以保留17Khz以下的波.
```

```
Q:RC并联怎么是低通滤波器呢？
A:电容对高频信号阻碍小, 并联电容, 高频信号就会经管电容旁路到地端.但是电容对低频信号阻碍大, 低频信号不会被旁路掉, 就会流向下一级
```

运放大师(3)双电压供电,负电压产生,单电源供电.

```
运放单电源供电: 输出小信号误差较大, 能处理的频率较低<100Khz
处理直流和低频交流.

单电源供电用的多的地方:反相比例,同相比例,差分电路.

耦合: 频率相同,相加减. 直流耦合,交流耦合.
通过电容耦合到+IN时,+IN处需要加一个电阻进行阻匹配.
通过电容耦合到-IN时,不需要.
22nF < 50Mhz
100pF >500Mhz


单电源供电, 反馈Rf串一个Cf,低通滤波器,进行滤波. Rf//Cf在-IN接一个电阻R2电容C2的串到地. 有了电容C,只放大交流.
有C2 放大为 Vcc/2 + Vi * Au
无C2 放大为 ( Vcc/2 + Vi) * Au

单电源:制造虚地, 分压->电压跟随器(变阻抗) TL431芯片 稳压二极管.
TL431并联的电容 <0.01uF 或者 >3.3uF
```

```
Q:还有四层板布线的时候, 信号层不覆铜（地层）, 为了防止运放的反相输入端和输出端由于和地之间的杂散电容而导致运放的震荡.那这个信号层不覆铜, 是要求呢？还是说间距大一点也是可以覆铜的？
A:可以敷铜, 注意反向输入端敷铜间距大一点即可, 然后低频的要求不严格, 高频需要特别小心, 1MHz以下都不需要太在意.
Q:供电滤波电容
A:这个是经验之谈, 100M示波器上一般都用22nf, 频率再高就降低一点电容量
Q:使用膝点电压低的电容（钽电容、C0G等等）和薄膜电阻器来帮助降低失真度.这句话里面的膝点电压是什么意思？
A:没这种说法, 膝点是电磁铁磁化曲线里面快饱和的那个点的电压
Q:唐老师 为什么运放阻容耦合的时候一定要接一个电阻到底呀？
A:需要直流通路
A:单电源供电是一种不正常的工作状态, 超过100K也行, 只不过误差稍微大一点点.
```

运放大师(4)双电压供电,负电压产生,单电源供电.

```
供电: 首先考虑尽可能使用双电源
单电源(频率f < 100Khz,直流)可以使用.
趋势:低压化,国产化
通用运放:Vos>1mV
精密运放:Vos<1mV

大多数情况下,使用电压反馈运放 VFB.CFB在频率f>10Mhz时使用.

有源滤波器使用于截止频率<5Mhz的场合.当截止频率>5Mhz,最好采用LC无源滤波器.

趋势是软件滤波,用加法将信号抬高到0轴以上,用ADC采集后,FFT变换,区分出高频信号,进行滤波.

采集电压Vi小时,去掉R5,保留R4 R2 R3,进行放大后输入STM32的ADC进行采集.
采集电压Vi大时,经过R4 R5分压到3V以内,去掉R2,做成电压跟随器后ADC进行采集.
运放的供电可以为3.3V以作为过压保护.

单片机的ADC的 Rin Cin 计算. 需要关注ADC的参数: 采样开关电阻Rsw 采样保持电容Csh
Cin > 20 * Csh
Cin * Rin = 0.7 * Rsw * Csh

STM32的 采样开关电阻1K欧姆 采样保持电容12pF
STC8的 采样开关电阻700欧姆 采样保持电容16.5pF
Cin 一般 479pF 680pF 1nF

ADC的保护,钳位:
 两个ss34, 双向TVS BAT545 BAV99 BAV199
```

```
Q:ADC Cin Rin的计算
CIN>20*CADC  和 CIN*RAIN = 0.7*CADC*RADC
RIN的电阻作用是用来消除加入了CIN电容之后, 会引起的运放输出不稳定, 而加入的电阻.这个电阻只需要大于运放的输出电阻就能够满足基本上所有的容性负载.然后公式中的CIN*RAIN = 0.7*CADC*RADC的原因是要求RIN和CIN构成的电路要满足ADC的采样速率, 也可以理解为, RIN和CIN构成的充电时间常数要小于CADC和RADC的充电时间常数.CIN>20*CADC的原因是要求CADC可以在CIN上取得稳定的电压要求的.
Q:想问一下有源滤波器输入信号才出SMA端子就有衰减是什么呀, 而且照着软件设计的参数焊出来完全得不到结果
A:要调试, 然后看看运放的带宽够不够
```

运放大师(5)数据手册与设计实践

```
运放重要参数:
	供电电压Vs,需要 * 0.8使用
	增益带宽积GBW,
	压摆率Slew Rate,
NMOS重要参数:
Vds Id Rds(on) Qg

运放的统计表格: 型号 数量 Vs Vos GBW SR IB Iq Vn 售价
实际例子:
AD9833 DDs 偏置电压0.37V 幅值0.6Vpp 频率f 1Khz 通讯 SPI
运放推荐:GS8592 RS8558

AD9833输出信号通过R1 R2分压后 进入Uo的电压跟随器获取电压V1; V1通过U1的正相比例放大后进入ADC1; V1通过电阻Rs获得电压V2; V2通过U2的正相比例放大后进入ADC2; V2通过三极管放大后接RL和继电器的串, 并一个R6 R5, 中间的电压通过电压跟随器后进入ADC3.

可以计算得通过Rs的电流Ii = (V1ac - V2ac)/Rs.
三极管的Ri = V2ac/Ii
通过开关继电器可以计算出RL.

运放选择: Vs * 0.8
GBW > (10~100) * gain * f
SR > 2 * pai * f * Vopp
```

