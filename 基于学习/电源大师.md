## 电源大师

DCDC电源

```
线性电源
	线性电源,压差>1.2V
	LD0, 压差<=1.2V
开关电源
	电容式开关电源(电荷泵)
		反相
		倍压
		半压
	电感式开关电源
		buck
		boost
		buck-boost
```

公司技术排名

```
TI > 南芯>ADI>MPS
南芯用的晶圆倒装, QFN封装,对DIY不友好
```

### 线性电源

线性电源参数

```
输入电压Vi
输出电压Vo
压差Vd
噪声
静态电流Iq
```

LDO开关

```
工艺:
两个NPN达林顿管 2V
一个NPN,一个PNP, 1V 准LDO
一个PNP, 0.3V, LDO
NMOS , <0.5v, LD0
PMOS

PMOS的LDO 成本是最优,是主流, Vd也小
Mos的LDO的问题:电流可能倒灌 反接容易出问题  可靠性比较低
```

选择

```
输入电压Vin>管压降Vd + 输出电压Vout
效率: n = Vout/Vin
注意: Vin - Vout > Vd(压差)
手持设备应该选低Iq(静态电流)的LDO
7085 Vd = 2.5V 
LM317 Vd = 3V
```

注意

```
LDO不能并联扩流,会烧毁.除了RT9068
LDO可以通过三极管扩流,需要注意成本.
电流反馈型可以并联扩流,LT3080
兼顾纹波和效率: buck 后接磁珠和电感做的LC低通滤波,再接LDO.
手机无线充电: 发送端电磁波, 接收端的电磁波谐振接收能量 接收端用LDO来降压
不需要Co XC6504
测井仪器:芯片有过热保护,不能用于测井,所以用运放和独立元件搭建LDO来供电.
```

PCB注意

```
输入需要经过Ci再入IC
输出需要经过Co再入RL
Ci,Co紧靠VIN,VOUT,GND.
输出要经过Co再入反馈
芯片底部和周围大面积铺铜,增加散热.
R1,R2贴近IC
```

### 电容式开关电源(电荷泵)

重要参数

```
vi输入电压
Vo输出电压
Io输出电流
Iq关断电流
Vn噪声
```

芯片

```
非稳压型电荷泵
	负压 ICL7660 ICL7662
	倍压
	半压 SC8551 NU2205 LTC7820
稳压型电荷泵
	升压 HX4002 HX4004
	降压 DRV8301
	负压 LM7705
```

工作原理

```
负压:周期0~2Π, 0~Π, 电容正接(VCC,GND)充电, Π~2Π,电容反接(原VCC接GND, 原GND接Vout)放电
倍压: 周期0~2Π, 0~Π,电容并联充电, Π~2Π,串联放电.
半压:周期0~2Π, 0~Π,电容串联充电, Π~2Π,并联放电.
```

```
电容式降压: 降压: 线性电源->半压	半压->LDO

ICL7660 ICL7662 负压
Fsw越大, 周期T越小,Cfly越小,容易充满
四个开关内置,Io很小
可以并联,增加输出.

MAX232 倍压后负压 获得 2Vi -2Vi
可以用作串口通信的供电
LM7705结构: 负压->LDO
UC7820结构: 开关外置, 加检测Io的过流保护
```

电容选择

```
推荐: 电容Ci Cfly Co 为的电容量为芯片手册推荐的2倍, 耐压为寻常承受电压的两倍,电容的ESR越小越好
顺序: MLCC(X7R>x5R) > 钽电容 > 固态电容 > 高频低阻电解 > 电解

电容比较大好一些:
温度T上升,电容下降,温度T下降,电容下降,随时间推移,电容下降.需要留余裕.(上电复位电路,电容量随时间减小,失去复位作用.)
电容量大一些,可以承受更多电流通过.
电容过大,电感容易过热损毁,电容过小容易烧毁电容(上电瞬间的过冲电压损坏电容).

电容的ESR越小:
减少输出纹波(输出电容Co的ESR减小, Co变大)
电容的ESR越小效率越高
```

PCB设计

```
没什么讲究, Ci Cfly Co 接近芯片, 
如果是稳压型,发热大一些,焊盘做大.

降低纹波: 
Ci Co都并联一个0.1uF, Ci的0.1uF靠近芯片, Co的0.1uF远离芯片
20欧姆Rp 和Cp RC低通滤波
600m欧姆磁珠Lp和Cp  LC低通滤波
```

其他

```
开关管内置的Io<=200mA, 外置的Io可达20A
非稳压型效率可达99%

特殊:
LDO 压差小的效率很高
开关电源的噪声可以很小
电荷泵的芯片的开关外置的电流可以很大.

电荷泵与电感式DCDC比优点:
	高效率
	体积小
	低静态电流
	最低工作电压更低
	低噪声

手机快充, 20V高压送电,输电线的发热小,手机内部空间宝贵,不能放电感, 所以用的半压
```

### buck

降压BUCK应用

```
降压 STEP DOWN
负电压 
FLYBUCK升降压,负电压,多组输出(隔离式flybuck 非隔离式flybuck)
ZETA升降压
正电压升降压
```

BUCK原理

```
降压:开关打开,电感充电.  开关闭合,肖特基续流,电感给后面供电.  后接电容滤波,减少纹波.(大电容储能,小电容滤波)
	输入电容里面小的滤波, 大的是储能的, 负载突然加大, 
	输入电压会跌落, 输入电容会回吐储能
	
	开关可以用NPN PMOS NMOS,现在主流式NMOS
	二极管,低压用肖特基,高压用快恢复二极管
	芯片内置的开关通过电流小, 大于5A,使用外置NMOS

电感式开关电源里面有80%都是buck电路
占空比D = ton/(ton+toff) = ton/Ts
周期 Ts = 1/Fsw
效率n = Vo/Vi = D < 1
肖特基损耗: Uf * Io ( 例如 0.3欧姆 * 1A) 肖特基二极管的Uf小,损耗小
同步整流肖特基换为NMOS, 
NMOS损耗: Rds(on) * Io (比如 0.1欧姆 * 1A), 比肖特基小.
同步整流buck电路上下管不能同时导通(会导致短路),需要设置死区,一般为12ns到28ns之间
下管并联一个肖特基,可以提高效率
	
负电压:降压电路的GND连起来做输出,Vout连GND即可
FLYBUCK:使用同步电感,需要同步整流buck芯片
	升降压: 改变同步的绕组, 使用电荷泵
	负电压:降压电路的GND连起来做输出,Vout连GND即可
	多组输出:多个绕组, 使用电荷泵
	隔离,非隔离是看多个输出的GND是否连在一起.
ZETA升降压: 降压电路加一个电感一个电容. 主线路上开关和电感间加一个电容, 这个电容和开关间加一个电感到地.
	所有buck电路都可以改造为zeta电路,用来做升降压
	增加一个电感和一个电容, 
	电感可以用一个耦合电容(贵)或两个非耦合电感(便宜)
	能量传递, C1 95%, L1 5% ,如果不用耦合电感会损失5%
正电压升降压(后面添加两个开关,相当于buck后接boost)(性价比不高)
```

```
flybuck 给运放供电很好, 纹波小
```

```
纹波小,EMI小,消减振铃信号:
buck: 电感LC滤波->CI->0.1ufCi->开关->续流->电感->Co->0.1ufCo->磁珠LC滤波
晶圆倒装, 0.1ufCi尽可能靠近VIN,GND, RC缓冲抑制电路, 反馈可以取Co->0.1ufCo之间,R1,R2尽可能靠近FB引脚.

封装:金线键合对DIY友好,晶圆倒装EMI非常小
开关切换时会有高频振铃信号产生:
 	开关寄生电感 * (引脚电感+ Ci距离VIN和GND的电感+ Ci本身寄生电感)
 	晶圆倒装可以大大减小引脚电感
 	Ci选用0.1uF可以减少Ci本身寄生电感
 	Ci距离VIN,GND尽可能近可以可以减小其中电感
 	电感可以集成到芯片内部,减少寄生电感
buck: CI->0.1ufCi->开关->续流->电感->Co->0.1ufCo
	开关闭合时,0.1ufCi->开关->续流->电感->Co 围成的回路有电流, 开关打开时,续流->电感->Co围成的回路有电流, 而0.1ufCi->开关->续流围成的回路无电流.
	0.1ufCi->开关->续流围成的回路电流变化大,即di/dt变化大,容易成为一个电感,产生EMI, 需要尽量减少这个回路的面积.
	即0.1ufCi距离VIN,GND尽可能近.
RC缓冲抑制电路:
	添加RC缓冲电路可以有效抑制振铃现象,同时造成开关切换损耗增加.
	RC缓冲电路应当放置在紧靠开关节点和功率地处.
	
	Buck芯片软启动的GND,反馈的GND,相位补偿的GND,都是小信号的地,
	功率地与小信号的地单点相连,或者通过过孔相连,减少环路电流.
	进行EMI设计, 前面加电感 IMC滤波,后面加磁珠,IMC滤波,纹波可能比LDO还小.
```

芯片参数

```
参数: VI VO IO Fsw EN VFB
Up常用芯片 TPS5450

计算:
可以用官网的来计算,
可以用官网的数据手册来计算
可以用电阻分压计算器来计算(Err比较小好一些),可以参考数据手册来看
```

参数设计

```
尽量利用厂商的参数设计: 
TI的webench
MPS的 DC DC在线设计师
中国大陆比较有名的是龙芯,南芯,圣邦微
```

效率与频率的关系

```
频率升高: 开始效率升高,达到最大,效率减小, 
前面是导通损耗占主要, 后是开关损耗
频率上升,需要的电感变小, 可以用更粗的线做电感, DCR就小.电感上的损耗就更小
```

CIN,COUT选择

```
CIN:高频低阻电解或固态电容 + MLCC X7R 22uF+0.1uF
COUT:MLCC X7R 0.1uF + MLCC X7R 22uF + 固态电容.
MLCC > 钽电容 > 固态电容 > 高频低阻电解 > 铺铜电解
```

BUCK开关电源PCB layout宝典

```
1.采用晶圆倒装工艺的BUCK芯片 (DIY不可行)
2.将Ci集成到芯片内部(一般芯片不可行)
3.电感RC->Ci->0.1ufCi->芯片->电感->Co->o.1ufCo->磁珠RC
4.0.1ufCi->芯片, 0.1ufCi尽量靠近芯片的VIN和GND引脚,强行滤波后再进入芯片引脚.
5.与FB相连的两个电阻越靠近FB引脚越好,FB覆盖面积越小越好.走线细而短,可以滴上704硅胶,防止手摸.
6.减少辐射EMI,减少高di/dt回路面积,SW覆盖面积越小越好.高di/dt回路是最看重的回路.
7.小信号地连一起(FB分压电阻,COMP相位补偿,ss软起动),然后再与PGND单点相连,或者通过过孔连到背面.这些周围不敷铜.
8.电感采用一体成型屏蔽电感,将电磁场封锁.
9.背面走线越少越好,背面走线最好与正面走线垂直,然后最好全部敷铜到GND.
10.电感两个引脚间距离尽可能大一些,可以选大一尺寸的电感,如果位置允许. 非一体成型电感最好把GND挖空,一挖到底,还要让敏感电路和回路远离电感.特别是VO到FB的走线.特别要避开电感,二级管,特别是不能和电感并行.
11.PCB设计参考厂家数据手册.
12.最好是用4层板,一层器件,2层GND,3层4层走线.
```

案例:

```
由两只22uF/25V大型电容器换成小体积的22uF/6.3V电容
22uf/6.3V 0805 规格的MLCC 电容在3.3V 直流偏置下只有11uF的容量
BUCK输出的低交流纹波又使得这个值还要再降低28%
所以最后得到的输出电容只有16uF的有效值.低于设计值44uF.
启示:Co的耐压应当远大于Vo,才能保证电容量不过分减小.Ci 0.1uFCi CO的尺寸可以大一点.
```

### boost

常用BOOST芯片 

```
B628(SX1308、MT3608) 
XL6019 
TPS55340 
TPS40210 
TPS61088 
LM5122  
B628和XL6019可以解决你98%的升压问题.同步整流BOOST, 非同步整流BOOST 开关管内置/开关管外置 BOOST电路不能关断, 
主要是PBC布线要把握几点:SW面积越小越好, 电感越靠近芯片越好, 两个反馈电阻靠近FB脚, VO到反馈电阻间连线避开SW, 电感, 最好包地.
```

boost应用

```
升压boost
sepic正压升降压
cuk负压升降压
sepic+cuk正负双电压升降压
flyback(隔离式flyback, 非隔离式flyback)
forward正激
```

结构

```
Boost: ton,开关打开,电感充电, toff, 开关闭合,肖特基导通,电感+VIN供电升压. 电容滤波稳压.
	CI->电感->开关->肖特基->Co->反馈
SEPIC:(耦合电感的电感量是非耦合的1/2)
	CI->电感->开关->电容->电感->肖特基->Co->反馈 升降压
FLYBACK反激:反激不能空载.
	CI->高频电感->(开关->肖特基->Co->反馈->输出1), (肖特基->Co->输出2)
```

boost注意

```
boost不能关断电流,除非有保护电路.
boost不能防止短路.需要有保护电路.
保护电路通常由 PNP 或 PMOS等组成.
```

EMC设计

```
最重要的高di/dt回路, 含电感的回路可以排除(电感电流不会突变)
	CI->电感->开关->肖特基->Co->0.1uFCo-->反馈 
	ton: CI->电感->开关 Co->0.1uFCo-->反馈 有电流
	toff:CI->电感->开关->肖特基->Co->0.1uFCo->反馈 有电流
	高di/dt回路: 开关->肖特基->Co, 即SW
SW面积越小越好, 电感越靠近芯片越好, 
两个反馈电阻靠近FB脚, VO到反馈电阻间连线避开SW, 电感, 最好包地.
```

BOOST开关电源PCB layout宝典

```
1.高di/dt回路面积越小越好,这里指的是sw->肖特基->Co.

5.与FB相连的两个电阻越靠近FB引脚越好,FB覆盖面积越小越好.走线细而短,可以滴上704硅胶,防止手摸.
6.减少辐射EMI,减少高di/dt回路面积,SW覆盖面积越小越好.高di/dt回路是最看重的回路.
7.小信号地连一起(FB分压电阻,COMP相位补偿,ss软起动),然后再与PGND单点相连,或者通过过孔连到背面.这些周围不敷铜.
8.电感采用一体成型屏蔽电感,将电磁场封锁.
9.背面走线越少越好,背面走线最好与正面走线垂直,然后最好全部敷铜到GND.
10.电感两个引脚间距离尽可能大一些,可以选大一尺寸的电感,如果位置允许. 非一体成型电感最好把GND挖空,一挖到底,还要让敏感电路和回路远离电感.特别是VO到FB的走线.特别要避开电感,二级管,特别是不能和电感并行.
11.PCB设计参考厂家数据手册.
12.最好是用4层板,一层器件,2层GND,3层4层走线.

13BOOST的Co的地不纯净, 不能作为FB的地.
```

地是否纯净?

```
Buck电路的Ci的GND不纯净,Co的GND纯净,
Boost电路的Ci的GND纯净,Co的GND不纯净,
判断条件为是否位于高di/dt回路中.
Boost电路的GND最好与FB的地单点相连.否则会造成纹波.

电感的两个脚过近,会引入一个寄生电容,引起振荡.
```

### BUCK-BOOST

途径

```
升降压 BUCK-BOOST
BUCK芯片负电压升降压 
BUCK芯片正电压升降压 (不合算)
BUCK芯片ZETA正电压升降压
BOOST芯片 SEPIC正压升降压(可以给运放供电,可以用耦合电感,可以不用,SEPIC最好是用非同步整流BOOST)
BOOST芯片 CUK负压升降压
SEPIC-CUK正负双电压升降压
FLABCK反激正电压(必须用耦合电感)
两开关管/四开关管BUCK-BOOST
```

最常用 

```
	BUCK芯片ZETA正电压升降压
	BOOST芯片 SEPIC正压升降压(可以给运放供电,可以用耦合电感,可以不用)
```

```
单片机 NMOS驱动 四开关 STM32F334 FD2105 做升降压
TI 残次品 降电压 降电流, 改名称. LM5118->LM25118
TPS63070 智能小车经常用,但是不好焊接.
MPS型号注水严重
SC8801是双向DCDC,降压最小电感,升压最小电感,取大,然后*1.2
zeta可以用耦合电感, 可以不用.zeta升降压不用耦合电感会降低5%的效率.
Flyback实现升降压,必须用耦合电感
SEPIC最好是用非同步整流BOOST
SEPIC高di/dt为两个开关和Co的回路, 
疏松电感去共模纹波更有效
磁珠LC低通去差模纹波更有效
```

常用BUCK-BOOST芯片

```
常用BUCK-BOOST芯片
SC8701
SC8703
SC8903
RT6150
LM5175
TPS6020
TPS6060
TPS6070
LM5118
LM25118
LTC3789
```

### 参数计算

```
TPS55340
TPS52560
```

```
降压,没有工具,参考TI的TPS54560,将频率改换.
电容,MLCC >钽电容 > 固态电容 > 高频低阻电解 >电解
Ci的耐压为VIN * 2, 电容量翻倍.
CO的耐压为VOUT * 2, 电容量翻倍.
IC左边并一个0.1ufC1, 负载左边并一个0.1ufCo.
分压电阻的阻值不要乱取,R1要与芯片手册相近.
自举电容可以参照计算结果.
电感量可以参照,电感通过电流为 Io * 1.5,封装选一体成型屏蔽电感.
```

```
升压电路参考 TPS55340, 电感感量可以取大点,(2倍,5倍都可以),电感的封装可以取大点.1206都行.
```

```
前馈电阻计算:
TI: Cff = 1 / ( 2 * 派 * ( Fsw / 20 ) * R1) 有点粗暴
另一个: Cff = 1 / ( 2 * 派 * R1 * BW * 0.8), BW为 R1上的电压振荡周期. 
如果datasheet上说可以加前馈电阻,就可以加,否则不要加.
加入前馈电阻,可以减少负载突变时的过冲.
Ss 软启动, 可以使突然加上负载时,电压缓慢上升,不会过冲.ss为小信号,电容值可以取的稍大一点.
输出电压最小值等于内部参考源电压.
保留上部电阻.
分压电阻不可以乱取.
```

### 电路镜数控电压源设计,PWM做ADC

```
最终方案: STM32芯片输出PWM->两级RC低通滤波变直流->电压跟随器变阻抗->电流镜替代R1->控制电源芯片Vo输出.

直接通过DAC来控制芯片的电压输出.问题是DAC输出电流越小,VO越大.

解决方法是,通过电流镜来代替R1,使得DAC电流上升时,输出电压Vo上升.电流镜BCV61很便宜.0.7元.计算时需要注意电流镜管压降0.7V

但是DAC很贵.用PWM做DAC
PWM需要变为直流,同时滤波, 所以要两级低通滤波,同时PWM的频率较高,比如2Khz,纹波会比较小,同时PWM的占空比D比较大,纹波也会减少.
PWM的阻抗不可控,可以使用电压跟随器改变阻抗.或者使用正比例运放,改变阻抗时也可以调节输出电压.运放的Rf可以并联一个去耦电容.减少纹波.
降压芯片可以使用LM5117 LM5116

其他方案:直接2596＋一个358做比例积分器不就行了.给多少DAC输出N*DAC,https://oshwhub.com/Suaig/mppt里面的DC-DC是2596模块拆掉滑动变阻器露出FB端.
```